#include <cstring>
//---------------------------------------------------------------------------
#include "Block256BitPacking.hpp"
//---------------------------------------------------------------------------
namespace compression {
//---------------------------------------------------------------------------
namespace bitpacking {
//---------------------------------------------------------------------------
namespace simd64 {
//---------------------------------------------------------------------------
typedef void (*avxpackblockfnc)(const u64 *pin, __m256i *compressed);
typedef void (*avxunpackblockfnc)(const __m256i *compressed, u64 *out);

static void avxpackblock0(const u64 *pin, __m256i *compressed) {
  (void)compressed;
  (void)pin; /* we consumed 256 64-bit integers */
}

/* we are going to pack 256 1-bit values, touching 1 256-bit words, using 32
 * bytes */
static void avxpackblock1(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  1 256-bit word */
  __m256i w0;
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 63));
  _mm256_storeu_si256(compressed + 0, w0);
}

/* we are going to pack 256 2-bit values, touching 2 256-bit words, using 64
 * bytes */
static void avxpackblock2(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  2 256-bit words */
  __m256i w0, w1;
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 62));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 62));
  _mm256_storeu_si256(compressed + 1, w1);
}

/* we are going to pack 256 3-bit values, touching 3 256-bit words, using 96
 * bytes */
static void avxpackblock3(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  3 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 60));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 59));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 61));
  _mm256_storeu_si256(compressed + 2, w0);
}

/* we are going to pack 256 4-bit values, touching 4 256-bit words, using 128
 * bytes */
static void avxpackblock4(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  4 256-bit words */
  __m256i w0, w1;
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 60));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 60));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 60));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 60));
  _mm256_storeu_si256(compressed + 3, w1);
}

/* we are going to pack 256 5-bit values, touching 5 256-bit words, using 160
 * bytes */
static void avxpackblock5(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  5 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 55));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 1));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 56));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 57));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 58));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 59));
  _mm256_storeu_si256(compressed + 4, w0);
}

/* we are going to pack 256 6-bit values, touching 6 256-bit words, using 192
 * bytes */
static void avxpackblock6(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  6 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 54));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 56));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 58));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 54));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 56));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 58));
  _mm256_storeu_si256(compressed + 5, w1);
}

/* we are going to pack 256 7-bit values, touching 7 256-bit words, using 224
 * bytes */
static void avxpackblock7(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  7 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 56));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 55));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 54));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 53));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 52));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 51));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 57));
  _mm256_storeu_si256(compressed + 6, w0);
}

/* we are going to pack 256 8-bit values, touching 8 256-bit words, using 256
 * bytes */
static void avxpackblock8(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  8 256-bit words */
  __m256i w0, w1;
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 56));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 56));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 56));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 56));
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 56));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 56));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 56));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 56));
  _mm256_storeu_si256(compressed + 7, w1);
}

/* we are going to pack 256 9-bit values, touching 9 256-bit words, using 288
 * bytes */
static void avxpackblock9(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  9 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 54));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 53));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 52));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 51));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 50));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 49));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 48));
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 47));
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 55));
  _mm256_storeu_si256(compressed + 8, w0);
}

/* we are going to pack 256 10-bit values, touching 10 256-bit words, using 320
 * bytes */
static void avxpackblock10(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  10 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 50));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 46));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 52));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 48));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 54));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 50));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 46));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 52));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 48));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 54));
  _mm256_storeu_si256(compressed + 9, w1);
}

/* we are going to pack 256 11-bit values, touching 11 256-bit words, using 352
 * bytes */
static void avxpackblock11(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  11 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 44));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 46));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 48));
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 50));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 52));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 43));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 45));
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 47));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 49));
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 51));
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 53));
  _mm256_storeu_si256(compressed + 10, w0);
}

/* we are going to pack 256 12-bit values, touching 12 256-bit words, using 384
 * bytes */
static void avxpackblock12(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  12 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 48));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 44));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 52));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 48));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 44));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 52));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 48));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 44));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 52));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 48));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 44));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 52));
  _mm256_storeu_si256(compressed + 11, w1);
}

/* we are going to pack 256 13-bit values, touching 13 256-bit words, using 416
 * bytes */
static void avxpackblock13(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  13 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 39));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 1));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 40));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 41));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 42));
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 43));
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 44));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 45));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 46));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 47));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 48));
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 49));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 50));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 51));
  _mm256_storeu_si256(compressed + 12, w0);
}

/* we are going to pack 256 14-bit values, touching 14 256-bit words, using 448
 * bytes */
static void avxpackblock14(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  14 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 42));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 48));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 40));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 46));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 38));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 44));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 50));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 42));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 48));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 40));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 46));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 38));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 44));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 50));
  _mm256_storeu_si256(compressed + 13, w1);
}

/* we are going to pack 256 15-bit values, touching 15 256-bit words, using 480
 * bytes */
static void avxpackblock15(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  15 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 45));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 41));
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 37));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 48));
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 44));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 40));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 36));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 47));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 43));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 39));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 35));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 1));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 46));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 42));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 38));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 49));
  _mm256_storeu_si256(compressed + 14, w0);
}

/* we are going to pack 256 16-bit values, touching 16 256-bit words, using 512
 * bytes */
static void avxpackblock16(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  16 256-bit words */
  __m256i w0, w1;
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 48));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 48));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 48));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 48));
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 48));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 48));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 48));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 48));
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 48));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 48));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 48));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 48));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 48));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 48));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 48));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 48));
  _mm256_storeu_si256(compressed + 15, w1);
}

/* we are going to pack 256 17-bit values, touching 17 256-bit words, using 544
 * bytes */
static void avxpackblock17(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  17 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 34));
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 38));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 42));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 46));
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 33));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 37));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 41));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 45));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 36));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 40));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 44));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 31));
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 1));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 35));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 39));
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 43));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 47));
  _mm256_storeu_si256(compressed + 16, w0);
}

/* we are going to pack 256 18-bit values, touching 18 256-bit words, using 576
 * bytes */
static void avxpackblock18(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  18 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 36));
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 44));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 34));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 42));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 40));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 30));
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 38));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 46));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 36));
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 44));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 34));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 42));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 40));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 30));
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 38));
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 46));
  _mm256_storeu_si256(compressed + 17, w1);
}

/* we are going to pack 256 19-bit values, touching 19 256-bit words, using 608
 * bytes */
static void avxpackblock19(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  19 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 38));
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 31));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 43));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 36));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 29));
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 41));
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 34));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 27));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 39));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 44));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 37));
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 30));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 42));
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 35));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 28));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 40));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 33));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 45));
  _mm256_storeu_si256(compressed + 18, w0);
}

/* we are going to pack 256 20-bit values, touching 20 256-bit words, using 640
 * bytes */
static void avxpackblock20(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  20 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 40));
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 36));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 32));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 28));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 44));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 40));
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 36));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 32));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 28));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 44));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 40));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 36));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 32));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 28));
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 44));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 40));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 36));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 32));
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 28));
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 44));
  _mm256_storeu_si256(compressed + 19, w1);
}

/* we are going to pack 256 21-bit values, touching 21 256-bit words, using 672
 * bytes */
static void avxpackblock21(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  21 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 42));
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 41));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 40));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 39));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 38));
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 37));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 36));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 35));
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 34));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 33));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 31));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 30));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 29));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 28));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 27));
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 26));
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 25));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 24));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 23));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 43));
  _mm256_storeu_si256(compressed + 20, w0);
}

/* we are going to pack 256 22-bit values, touching 22 256-bit words, using 704
 * bytes */
static void avxpackblock22(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  22 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 22));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 24));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 26));
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 28));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 30));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 34));
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 36));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 38));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 40));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 42));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 22));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 24));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 26));
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 28));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 30));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 34));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 36));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 38));
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 40));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 42));
  _mm256_storeu_si256(compressed + 21, w1);
}

/* we are going to pack 256 23-bit values, touching 23 256-bit words, using 736
 * bytes */
static void avxpackblock23(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  23 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 23));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 28));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 33));
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 38));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 20));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 25));
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 30));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 35));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 40));
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 22));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 27));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 37));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 19));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 24));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 29));
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 34));
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 39));
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 21));
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 26));
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 31));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 36));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 41));
  _mm256_storeu_si256(compressed + 22, w0);
}

/* we are going to pack 256 24-bit values, touching 24 256-bit words, using 768
 * bytes */
static void avxpackblock24(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  24 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 24));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 32));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 40));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 24));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 32));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 40));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 24));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 32));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 40));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 24));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 32));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 40));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 24));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 32));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 40));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 24));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 32));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 40));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 24));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 32));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 40));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 24));
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 32));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 40));
  _mm256_storeu_si256(compressed + 23, w1);
}

/* we are going to pack 256 25-bit values, touching 25 256-bit words, using 800
 * bytes */
static void avxpackblock25(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  25 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 25));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 36));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 22));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 33));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 19));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 30));
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 27));
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 38));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 24));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 35));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 21));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 18));
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 29));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 15));
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 26));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 37));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 23));
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 34));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 20));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 31));
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 17));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 28));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 39));
  _mm256_storeu_si256(compressed + 24, w0);
}

/* we are going to pack 256 26-bit values, touching 26 256-bit words, using 832
 * bytes */
static void avxpackblock26(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  26 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 26));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 14));
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 28));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 16));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 30));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 18));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 20));
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 34));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 22));
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 36));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 24));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 38));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 26));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 14));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 28));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 16));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 30));
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 18));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 20));
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 34));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 22));
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 36));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 24));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 38));
  _mm256_storeu_si256(compressed + 25, w1);
}

/* we are going to pack 256 27-bit values, touching 27 256-bit words, using 864
 * bytes */
static void avxpackblock27(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  27 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 27));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 17));
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 34));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 24));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 14));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 31));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 21));
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 11));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 28));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 18));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 35));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 25));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 15));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 22));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 12));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 29));
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 19));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 36));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 26));
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 33));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 23));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 13));
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 30));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 20));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 37));
  _mm256_storeu_si256(compressed + 26, w0);
}

/* we are going to pack 256 28-bit values, touching 28 256-bit words, using 896
 * bytes */
static void avxpackblock28(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  28 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 28));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 20));
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 12));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 32));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 24));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 16));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 36));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 28));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 20));
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 12));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 32));
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 24));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 16));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 36));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 28));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 20));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 12));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 32));
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 24));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 16));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 36));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 28));
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 20));
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 12));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 32));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 24));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 16));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 36));
  _mm256_storeu_si256(compressed + 27, w1);
}

/* we are going to pack 256 29-bit values, touching 29 256-bit words, using 928
 * bytes */
static void avxpackblock29(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  29 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 29));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 23));
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 17));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 11));
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 34));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 28));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 22));
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 10));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 33));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 27));
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 21));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 15));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 9));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 26));
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 20));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 14));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 31));
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 25));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 19));
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 13));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 7));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 30));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 24));
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 18));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 12));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 35));
  _mm256_storeu_si256(compressed + 28, w0);
}

/* we are going to pack 256 30-bit values, touching 30 256-bit words, using 960
 * bytes */
static void avxpackblock30(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  30 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 30));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 26));
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 22));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 18));
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 14));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 10));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 6));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 32));
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 28));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 24));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 20));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 16));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 12));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 8));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 34));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 30));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 26));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 22));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 18));
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 14));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 10));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 6));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 32));
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 28));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 24));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 20));
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 16));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 12));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 8));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 34));
  _mm256_storeu_si256(compressed + 29, w1);
}

/* we are going to pack 256 31-bit values, touching 31 256-bit words, using 992
 * bytes */
static void avxpackblock31(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  31 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 31));
  tmp = _mm256_lddqu_si256(in + 2);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 29));
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 27));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 25));
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 23));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 21));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 19));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 17));
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 15));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 13));
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 11));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 9));
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 7));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 5));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 3));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 1));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 32), 32));
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 30));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 28));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 26));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 24));
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 22));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 20));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 18));
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 14));
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 12));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 10));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 6));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 4));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 62), 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 33));
  _mm256_storeu_si256(compressed + 30, w0);
}

/* we are going to pack 256 32-bit values, touching 32 256-bit words, using 1024
 * bytes */
static void avxpackblock32(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  32 256-bit words */
  __m256i w0, w1;
  w0 = _mm256_lddqu_si256(in + 0);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 1), 32));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 32));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 32));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 32));
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 32));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 32));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 32));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 32));
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 32));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 32));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 32));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 32));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 32));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 32));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 32));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 32));
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 32));
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 32));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 32));
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 32));
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 32));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 32));
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 32));
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 32));
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 32));
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 32));
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 32));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 32));
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 32));
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 32));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 32));
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 32));
  _mm256_storeu_si256(compressed + 31, w1);
}

/* we are going to pack 256 33-bit values, touching 33 256-bit words, using 1056
 * bytes */
static void avxpackblock33(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  33 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 2));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 4));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 6));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 10));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 12));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 14));
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 18));
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 20));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 22));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 24));
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 26));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 28));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 30));
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 1));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 3));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 5));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 7));
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 9));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 11));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 13));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 15));
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 17));
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 19));
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 21));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 23));
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 25));
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 27));
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 29));
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 31));
  _mm256_storeu_si256(compressed + 32, w0);
}

/* we are going to pack 256 34-bit values, touching 34 256-bit words, using 1088
 * bytes */
static void avxpackblock34(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  34 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 4));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 8));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 12));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 16));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 20));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 24));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 28));
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 2));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 6));
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 10));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 14));
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 18));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 22));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 26));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 30));
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 4));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 8));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 12));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 16));
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 20));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 24));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 28));
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 2));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 6));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 10));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 14));
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 18));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 22));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 26));
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 30));
  _mm256_storeu_si256(compressed + 33, w1);
}

/* we are going to pack 256 35-bit values, touching 35 256-bit words, using 1120
 * bytes */
static void avxpackblock35(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  35 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 6));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 12));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 18));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 24));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 1));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 7));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 13));
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 19));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 25));
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 2));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 14));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 20));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 26));
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 3));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 9));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 15));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 21));
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 27));
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 4));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 10));
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 22));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 28));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 5));
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 11));
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 17));
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 23));
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 29));
  _mm256_storeu_si256(compressed + 34, w0);
}

/* we are going to pack 256 36-bit values, touching 36 256-bit words, using 1152
 * bytes */
static void avxpackblock36(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  36 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 8));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 16));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 24));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 4));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 12));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 20));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 28));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 8));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 16));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 24));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 4));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 12));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 20));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 28));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 8));
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 16));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 24));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 4));
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 12));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 20));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 28));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 8));
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 16));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 24));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 4));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 12));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 20));
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 28));
  _mm256_storeu_si256(compressed + 35, w1);
}

/* we are going to pack 256 37-bit values, touching 37 256-bit words, using 1184
 * bytes */
static void avxpackblock37(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  37 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 10));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 20));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 3));
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 13));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 23));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 6));
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 26));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 9));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 19));
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 2));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 12));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 22));
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 5));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 15));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 25));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 18));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 1));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 11));
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 21));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 4));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 14));
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 24));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 7));
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 17));
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 27));
  _mm256_storeu_si256(compressed + 36, w0);
}

/* we are going to pack 256 38-bit values, touching 38 256-bit words, using 1216
 * bytes */
static void avxpackblock38(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  38 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 12));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 24));
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 10));
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 22));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 8));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 20));
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 6));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 18));
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 4));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 16));
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 2));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 14));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 26));
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 12));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 24));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 10));
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 22));
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 8));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 20));
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 6));
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 18));
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 4));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 16));
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 2));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 14));
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 26));
  _mm256_storeu_si256(compressed + 37, w1);
}

/* we are going to pack 256 39-bit values, touching 39 256-bit words, using 1248
 * bytes */
static void avxpackblock39(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  39 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 14));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 3));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 17));
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 6));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 20));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 9));
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 23));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 12));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 1));
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 15));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 4));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 18));
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 7));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 21));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 10));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 24));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 13));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 2));
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 5));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 19));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 22));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 11));
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 25));
  _mm256_storeu_si256(compressed + 38, w0);
}

/* we are going to pack 256 40-bit values, touching 40 256-bit words, using 1280
 * bytes */
static void avxpackblock40(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  40 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 16));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 8));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 24));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 8);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 16));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 8));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 24));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 16));
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 8));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 24));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 24);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 16));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 8));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 24));
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 16));
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 8));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 24));
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_lddqu_si256(in + 40);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 16));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 8));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 24));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 16));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 8));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 24));
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_lddqu_si256(in + 56);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 16));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 8));
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 24));
  _mm256_storeu_si256(compressed + 39, w1);
}

/* we are going to pack 256 41-bit values, touching 41 256-bit words, using 1312
 * bytes */
static void avxpackblock41(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  41 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 18));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 13));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 3));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 21));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 11));
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 6));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 1));
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 19));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 14));
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 9));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 4));
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 22));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 17));
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 12));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 7));
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 2));
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 20));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 15));
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 10));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 5));
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 23));
  _mm256_storeu_si256(compressed + 40, w0);
}

/* we are going to pack 256 42-bit values, touching 42 256-bit words, using 1344
 * bytes */
static void avxpackblock42(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  42 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 2), 20));
  tmp = _mm256_lddqu_si256(in + 3);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 18));
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 16));
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 14));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 12));
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 10));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 8));
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 6));
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 4));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 2));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 22));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 20));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 18));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 16));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 14));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 12));
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 10));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 8));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 6));
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 4));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 61), 2));
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 22));
  _mm256_storeu_si256(compressed + 41, w1);
}

/* we are going to pack 256 43-bit values, touching 43 256-bit words, using 1376
 * bytes */
static void avxpackblock43(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  43 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 1));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 2));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 3));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 4));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 5));
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 6));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 7));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 9));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 10));
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 11));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 12));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 13));
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 14));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 15));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 17));
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 18));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 19));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 20));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 21));
  _mm256_storeu_si256(compressed + 42, w0);
}

/* we are going to pack 256 44-bit values, touching 44 256-bit words, using 1408
 * bytes */
static void avxpackblock44(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  44 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 4));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 8));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 12));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 16));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 20));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 4));
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 8));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 12));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 16));
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 20));
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 4));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 8));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 12));
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 16));
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 20));
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 4));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 8));
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 12));
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 16));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 20));
  _mm256_storeu_si256(compressed + 43, w1);
}

/* we are going to pack 256 45-bit values, touching 45 256-bit words, using 1440
 * bytes */
static void avxpackblock45(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  45 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 7));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 14));
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 2));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 9));
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 16), 16));
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 20), 4));
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 11));
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 18));
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 6));
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 13));
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 1));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 15));
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 3));
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 10));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 17));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 5));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 12));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 19));
  _mm256_storeu_si256(compressed + 44, w0);
}

/* we are going to pack 256 46-bit values, touching 46 256-bit words, using 1472
 * bytes */
static void avxpackblock46(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  46 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 10));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 2));
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 12));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 4));
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 14));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 6));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 16));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 8));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 18));
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 10));
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 2));
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 12));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 4));
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 14));
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 6));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 16));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 8));
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 18));
  _mm256_storeu_si256(compressed + 45, w1);
}

/* we are going to pack 256 47-bit values, touching 47 256-bit words, using 1504
 * bytes */
static void avxpackblock47(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  47 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 13));
  tmp = _mm256_lddqu_si256(in + 4);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 9));
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 5));
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 1));
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 14));
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 10));
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 6));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 19));
  w0 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 30), 2));
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 33), 15));
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 11));
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 7));
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 3));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 48), 16));
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 12));
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 21));
  w0 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 60), 4));
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 45, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 17));
  _mm256_storeu_si256(compressed + 46, w0);
}

/* we are going to pack 256 48-bit values, touching 48 256-bit words, using 1536
 * bytes */
static void avxpackblock48(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  48 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 3), 16));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 4);
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 16));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 8);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 16));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 12);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 16));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 16));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 20);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 16));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_lddqu_si256(in + 24);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 16));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 28);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 16));
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 16));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_lddqu_si256(in + 36);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 16));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_lddqu_si256(in + 40);
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 43), 16));
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_lddqu_si256(in + 44);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 16));
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 16));
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_lddqu_si256(in + 52);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 16));
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_lddqu_si256(in + 56);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 16));
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_lddqu_si256(in + 60);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 16));
  _mm256_storeu_si256(compressed + 47, w1);
}

/* we are going to pack 256 49-bit values, touching 49 256-bit words, using 1568
 * bytes */
static void avxpackblock49(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  49 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 4));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 8), 8));
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 12));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 1));
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 5));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 9));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 13));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 2));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 6));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 10));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 14));
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 3));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 7));
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 11));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 15));
  _mm256_storeu_si256(compressed + 48, w0);
}

/* we are going to pack 256 50-bit values, touching 50 256-bit words, using 1600
 * bytes */
static void avxpackblock50(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  50 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 8));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 2));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 13), 10));
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 4));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 22), 12));
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 6));
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 14));
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 8));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 41), 2));
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 10));
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 50), 4));
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 12));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 45, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 6));
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 48, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 14));
  _mm256_storeu_si256(compressed + 49, w1);
}

/* we are going to pack 256 51-bit values, touching 51 256-bit words, using 1632
 * bytes */
static void avxpackblock51(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  51 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 4), 12));
  tmp = _mm256_lddqu_si256(in + 5);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 11));
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 10));
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 9));
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 24), 8));
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 7));
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 6));
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 5));
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 4));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 3));
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 2));
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 59), 1));
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 49, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 13));
  _mm256_storeu_si256(compressed + 50, w0);
}

/* we are going to pack 256 52-bit values, touching 52 256-bit words, using 1664
 * bytes */
static void avxpackblock52(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  52 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 4));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 8));
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 12));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 4));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 26), 8));
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 12));
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 37), 4));
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 8));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 12));
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 4));
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 8));
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 50, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 12));
  _mm256_storeu_si256(compressed + 51, w1);
}

/* we are going to pack 256 53-bit values, touching 53 256-bit words, using 1696
 * bytes */
static void avxpackblock53(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  53 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 5), 9));
  tmp = _mm256_lddqu_si256(in + 6);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 11), 7));
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 17), 5));
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 3));
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 29), 1));
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 21));
  w0 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 34), 10));
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 40), 8));
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 46), 6));
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 52), 4));
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 58), 2));
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 51, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 11));
  _mm256_storeu_si256(compressed + 52, w0);
}

/* we are going to pack 256 54-bit values, touching 54 256-bit words, using 1728
 * bytes */
static void avxpackblock54(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  54 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 6), 4));
  tmp = _mm256_lddqu_si256(in + 7);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 8));
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 19), 2));
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 6));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 10));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 4));
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 44), 8));
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 2));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 57), 6));
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 52, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 10));
  _mm256_storeu_si256(compressed + 53, w1);
}

/* we are going to pack 256 55-bit values, touching 55 256-bit words, using 1760
 * bytes */
static void avxpackblock55(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  55 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 1));
  tmp = _mm256_lddqu_si256(in + 8);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 14), 2));
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 3));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 28), 4));
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 35), 5));
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 15));
  w0 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 6));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 49), 7));
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 56), 8));
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 53, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 9));
  _mm256_storeu_si256(compressed + 54, w0);
}

/* we are going to pack 256 56-bit values, touching 56 256-bit words, using 1792
 * bytes */
static void avxpackblock56(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  56 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 7), 8));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 8);
  tmp = _mm256_lddqu_si256(in + 9);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 8));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 23), 8));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 24);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 8));
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 39), 8));
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_lddqu_si256(in + 40);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 8));
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 55), 8));
  _mm256_storeu_si256(compressed + 48, w0);
  w1 = _mm256_lddqu_si256(in + 56);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 54, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 8));
  _mm256_storeu_si256(compressed + 55, w1);
}

/* we are going to pack 256 57-bit values, touching 57 256-bit words, using 1824
 * bytes */
static void avxpackblock57(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  57 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 9), 1));
  tmp = _mm256_lddqu_si256(in + 10);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 9));
  w0 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 18), 2));
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 27), 3));
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 36), 4));
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 45), 5));
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 54), 6));
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 55, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 7));
  _mm256_storeu_si256(compressed + 56, w0);
}

/* we are going to pack 256 58-bit values, touching 58 256-bit words, using 1856
 * bytes */
static void avxpackblock58(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  58 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 10));
  w1 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 10), 4));
  tmp = _mm256_lddqu_si256(in + 11);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 12);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 2));
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 6));
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 4));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 53), 2));
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 56, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 6));
  _mm256_storeu_si256(compressed + 57, w1);
}

/* we are going to pack 256 59-bit values, touching 59 256-bit words, using 1888
 * bytes */
static void avxpackblock59(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  59 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 9));
  w1 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 12), 4));
  tmp = _mm256_lddqu_si256(in + 13);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 14);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 15);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 16);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 25), 3));
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 7));
  w1 = _mm256_srli_epi64(tmp, 57);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 38), 2));
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 21));
  w0 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 6));
  w1 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 51), 1));
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 57, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 5));
  _mm256_storeu_si256(compressed + 58, w0);
}

/* we are going to pack 256 60-bit values, touching 60 256-bit words, using 1920
 * bytes */
static void avxpackblock60(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  60 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 15), 4));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 16);
  tmp = _mm256_lddqu_si256(in + 17);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 18);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 19);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 20);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 21);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 4));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 47), 4));
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_lddqu_si256(in + 48);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 58, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 4));
  _mm256_storeu_si256(compressed + 59, w1);
}

/* we are going to pack 256 61-bit values, touching 61 256-bit words, using 1952
 * bytes */
static void avxpackblock61(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  61 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 13));
  w1 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 7));
  w1 = _mm256_srli_epi64(tmp, 57);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 4));
  w0 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 21), 1));
  tmp = _mm256_lddqu_si256(in + 22);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 23);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 24);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 25);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 26);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 27);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 28);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 29);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 30);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 31);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 32);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 5));
  w0 = _mm256_srli_epi64(tmp, 59);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 42), 2));
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 9));
  w1 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 58, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 6));
  w0 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 59, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 3));
  _mm256_storeu_si256(compressed + 60, w0);
}

/* we are going to pack 256 62-bit values, touching 62 256-bit words, using 1984
 * bytes */
static void avxpackblock62(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  62 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 10));
  w1 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 6));
  w1 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 4));
  w0 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 31), 2));
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_lddqu_si256(in + 32);
  tmp = _mm256_lddqu_si256(in + 33);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 34);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 35);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 36);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 37);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 38);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 39);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 40);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 41);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 42);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 43);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 44);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 45);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 46);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 47);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 48);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 49);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 50);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 51);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 52);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 53);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 54);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 55);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 56);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 57);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_lddqu_si256(in + 58);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_lddqu_si256(in + 59);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_lddqu_si256(in + 60);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 58, w0);
  tmp = _mm256_lddqu_si256(in + 61);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 6));
  w0 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 59, w1);
  tmp = _mm256_lddqu_si256(in + 62);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 4));
  w1 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 60, w0);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 2));
  _mm256_storeu_si256(compressed + 61, w1);
}

/* we are going to pack 256 63-bit values, touching 63 256-bit words, using 2016
 * bytes */
static void avxpackblock63(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  63 256-bit words */
  __m256i w0, w1;
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_lddqu_si256(in + 0);
  tmp = _mm256_lddqu_si256(in + 1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_lddqu_si256(in + 2);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_lddqu_si256(in + 3);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_lddqu_si256(in + 4);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_lddqu_si256(in + 5);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_lddqu_si256(in + 6);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_lddqu_si256(in + 7);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_lddqu_si256(in + 8);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_lddqu_si256(in + 9);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_lddqu_si256(in + 10);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_lddqu_si256(in + 11);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_lddqu_si256(in + 12);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_lddqu_si256(in + 13);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_lddqu_si256(in + 14);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_lddqu_si256(in + 15);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_lddqu_si256(in + 16);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_lddqu_si256(in + 17);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_lddqu_si256(in + 18);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_lddqu_si256(in + 19);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_lddqu_si256(in + 20);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_lddqu_si256(in + 21);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_lddqu_si256(in + 22);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_lddqu_si256(in + 23);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_lddqu_si256(in + 24);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_lddqu_si256(in + 25);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_lddqu_si256(in + 26);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_lddqu_si256(in + 27);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_lddqu_si256(in + 28);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_lddqu_si256(in + 29);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_lddqu_si256(in + 30);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_lddqu_si256(in + 31);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_lddqu_si256(in + 32);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_lddqu_si256(in + 33);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_lddqu_si256(in + 34);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_lddqu_si256(in + 35);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_lddqu_si256(in + 36);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_lddqu_si256(in + 37);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_lddqu_si256(in + 38);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_lddqu_si256(in + 39);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_lddqu_si256(in + 40);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_lddqu_si256(in + 41);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_lddqu_si256(in + 42);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_lddqu_si256(in + 43);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_lddqu_si256(in + 44);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_lddqu_si256(in + 45);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_lddqu_si256(in + 46);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_lddqu_si256(in + 47);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_lddqu_si256(in + 48);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_lddqu_si256(in + 49);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_lddqu_si256(in + 50);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_lddqu_si256(in + 51);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 13));
  w1 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_lddqu_si256(in + 52);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_lddqu_si256(in + 53);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 11));
  w1 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_lddqu_si256(in + 54);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_lddqu_si256(in + 55);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 9));
  w1 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_lddqu_si256(in + 56);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_lddqu_si256(in + 57);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 7));
  w1 = _mm256_srli_epi64(tmp, 57);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_lddqu_si256(in + 58);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 6));
  w0 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_lddqu_si256(in + 59);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 5));
  w1 = _mm256_srli_epi64(tmp, 59);
  _mm256_storeu_si256(compressed + 58, w0);
  tmp = _mm256_lddqu_si256(in + 60);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 4));
  w0 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 59, w1);
  tmp = _mm256_lddqu_si256(in + 61);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 3));
  w1 = _mm256_srli_epi64(tmp, 61);
  _mm256_storeu_si256(compressed + 60, w0);
  tmp = _mm256_lddqu_si256(in + 62);
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 2));
  w0 = _mm256_srli_epi64(tmp, 62);
  _mm256_storeu_si256(compressed + 61, w1);
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(_mm256_lddqu_si256(in + 63), 1));
  _mm256_storeu_si256(compressed + 62, w0);
}

/* we are going to pack 256 64-bit values, touching 64 256-bit words, using 2048
 * bytes */
static void avxpackblock64(const u64 *pin, __m256i *compressed) {
  const __m256i *in = (const __m256i *)pin;
  /* we are going to touch  64 256-bit words */
  __m256i w0, w1;
  w0 = _mm256_lddqu_si256(in + 0);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 1);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_lddqu_si256(in + 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 3);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_lddqu_si256(in + 4);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 5);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 7);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_lddqu_si256(in + 8);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 9);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_lddqu_si256(in + 10);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_lddqu_si256(in + 11);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_lddqu_si256(in + 12);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_lddqu_si256(in + 13);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_lddqu_si256(in + 14);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 15);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_lddqu_si256(in + 17);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_lddqu_si256(in + 18);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_lddqu_si256(in + 19);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_lddqu_si256(in + 20);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 21);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_lddqu_si256(in + 22);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_lddqu_si256(in + 23);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_lddqu_si256(in + 24);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_lddqu_si256(in + 25);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_lddqu_si256(in + 26);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_lddqu_si256(in + 27);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_lddqu_si256(in + 28);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_lddqu_si256(in + 29);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_lddqu_si256(in + 30);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_lddqu_si256(in + 31);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_lddqu_si256(in + 33);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_lddqu_si256(in + 34);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_lddqu_si256(in + 35);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_lddqu_si256(in + 36);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_lddqu_si256(in + 37);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_lddqu_si256(in + 38);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_lddqu_si256(in + 39);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_lddqu_si256(in + 40);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_lddqu_si256(in + 41);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_lddqu_si256(in + 42);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_lddqu_si256(in + 43);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_lddqu_si256(in + 44);
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_lddqu_si256(in + 45);
  _mm256_storeu_si256(compressed + 45, w1);
  w0 = _mm256_lddqu_si256(in + 46);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_lddqu_si256(in + 47);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  _mm256_storeu_si256(compressed + 48, w0);
  w1 = _mm256_lddqu_si256(in + 49);
  _mm256_storeu_si256(compressed + 49, w1);
  w0 = _mm256_lddqu_si256(in + 50);
  _mm256_storeu_si256(compressed + 50, w0);
  w1 = _mm256_lddqu_si256(in + 51);
  _mm256_storeu_si256(compressed + 51, w1);
  w0 = _mm256_lddqu_si256(in + 52);
  _mm256_storeu_si256(compressed + 52, w0);
  w1 = _mm256_lddqu_si256(in + 53);
  _mm256_storeu_si256(compressed + 53, w1);
  w0 = _mm256_lddqu_si256(in + 54);
  _mm256_storeu_si256(compressed + 54, w0);
  w1 = _mm256_lddqu_si256(in + 55);
  _mm256_storeu_si256(compressed + 55, w1);
  w0 = _mm256_lddqu_si256(in + 56);
  _mm256_storeu_si256(compressed + 56, w0);
  w1 = _mm256_lddqu_si256(in + 57);
  _mm256_storeu_si256(compressed + 57, w1);
  w0 = _mm256_lddqu_si256(in + 58);
  _mm256_storeu_si256(compressed + 58, w0);
  w1 = _mm256_lddqu_si256(in + 59);
  _mm256_storeu_si256(compressed + 59, w1);
  w0 = _mm256_lddqu_si256(in + 60);
  _mm256_storeu_si256(compressed + 60, w0);
  w1 = _mm256_lddqu_si256(in + 61);
  _mm256_storeu_si256(compressed + 61, w1);
  w0 = _mm256_lddqu_si256(in + 62);
  _mm256_storeu_si256(compressed + 62, w0);
  w1 = _mm256_lddqu_si256(in + 63);
  _mm256_storeu_si256(compressed + 63, w1);
}

static void avxpackblockmask0(const u64 *pin, __m256i *compressed) {
  (void)compressed;
  (void)pin; /* we consumed 256 64-bit integers */
}

/* we are going to pack 256 1-bit values, touching 1 256-bit words, using 32
 * bytes */
static void avxpackblockmask1(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  1 256-bit word */
  __m256i w0;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 1));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 2));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 3));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 4));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 5));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 6));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 7));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            11));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            23));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            27));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            29));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            31));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            33));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            35));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            37));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            39));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            41));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            43));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            45));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            46));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            47));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            49));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            50));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            51));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            53));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            54));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            55));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            56));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            57));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            58));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            59));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            60));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            61));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            62));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            63));
  _mm256_storeu_si256(compressed + 0, w0);
}

/* we are going to pack 256 2-bit values, touching 2 256-bit words, using 64
 * bytes */
static void avxpackblockmask2(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  2 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(3);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 2));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 4));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 6));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            46));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            50));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            54));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            56));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            58));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            60));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            62));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            30));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            34));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            42));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            46));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            50));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            52));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            54));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            56));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            58));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            60));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            62));
  _mm256_storeu_si256(compressed + 1, w1);
}

/* we are going to pack 256 3-bit values, touching 3 256-bit words, using 96
 * bytes */
static void avxpackblockmask3(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  3 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(7);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 3));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 6));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            27));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            33));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            39));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            45));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            51));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            54));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            57));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            60));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            5));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            17));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            23));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            29));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            35));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            41));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            47));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            50));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            53));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            56));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            59));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            31));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            37));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            43));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            46));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            49));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            55));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            58));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            61));
  _mm256_storeu_si256(compressed + 2, w0);
}

/* we are going to pack 256 4-bit values, touching 4 256-bit words, using 128
 * bytes */
static void avxpackblockmask4(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  4 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(15);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 4));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            56));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            60));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            52));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            56));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            60));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            56));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            60));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            52));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            56));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            60));
  _mm256_storeu_si256(compressed + 3, w1);
}

/* we are going to pack 256 5-bit values, touching 5 256-bit words, using 160
 * bytes */
static void avxpackblockmask5(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  5 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(31);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            35));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            45));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            50));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            55));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            1));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            21));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            31));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            41));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            46));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            51));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            27));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            37));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            47));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            57));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            13));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            23));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            33));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            43));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            53));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            58));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            29));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            39));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            49));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            54));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            59));
  _mm256_storeu_si256(compressed + 4, w0);
}

/* we are going to pack 256 6-bit values, touching 6 256-bit words, using 192
 * bytes */
static void avxpackblockmask6(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  6 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(63);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            54));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            50));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            46));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            58));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            30));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            42));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            54));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            50));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            34));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            46));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            52));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            58));
  _mm256_storeu_si256(compressed + 5, w1);
}

/* we are going to pack 256 7-bit values, touching 7 256-bit words, using 224
 * bytes */
static void avxpackblockmask7(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  7 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(127);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            35));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            49));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            13));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            27));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            34));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            41));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            55));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            33));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            47));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            54));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            25));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            39));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            46));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            53));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            3));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            31));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            45));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            52));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            23));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            30));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            37));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            51));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            29));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            43));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            50));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            57));
  _mm256_storeu_si256(compressed + 6, w0);
}

/* we are going to pack 256 8-bit values, touching 8 256-bit words, using 256
 * bytes */
static void avxpackblockmask8(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  8 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(255);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            56));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            56));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            56));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            56));
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            56));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            56));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            56));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            56));
  _mm256_storeu_si256(compressed + 7, w1);
}

/* we are going to pack 256 9-bit values, touching 9 256-bit words, using 288
 * bytes */
static void avxpackblockmask9(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  9 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(511);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)), 9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            27));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            45));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            54));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            17));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            35));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            53));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            43));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            52));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            15));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            33));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            42));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            51));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            23));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            41));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            50));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            13));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            31));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            49));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            3));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            39));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            29));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            47));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            37));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            46));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            55));
  _mm256_storeu_si256(compressed + 8, w0);
}

/* we are going to pack 256 10-bit values, touching 10 256-bit words, using 320
 * bytes */
static void avxpackblockmask10(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  10 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1023);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            50));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            52));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            54));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            30));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            50));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            42));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            52));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            34));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            54));
  _mm256_storeu_si256(compressed + 9, w1);
}

/* we are going to pack 256 11-bit values, touching 11 256-bit words, using 352
 * bytes */
static void avxpackblockmask11(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  11 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(2047);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            11));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            33));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            13));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            35));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            37));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            17));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            39));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            50));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            41));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            52));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            21));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            43));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            23));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            45));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            25));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            47));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            27));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            49));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            7));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            29));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            51));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            31));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            42));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            53));
  _mm256_storeu_si256(compressed + 10, w0);
}

/* we are going to pack 256 12-bit values, touching 12 256-bit words, using 384
 * bytes */
static void avxpackblockmask12(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  12 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(4095);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            52));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            52));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            52));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            52));
  _mm256_storeu_si256(compressed + 11, w1);
}

/* we are going to pack 256 13-bit values, touching 13 256-bit words, using 416
 * bytes */
static void avxpackblockmask13(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  13 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(8191);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            39));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 1));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            27));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            41));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            29));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            43));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            5));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            31));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            45));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            7));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            33));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            47));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            35));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            23));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            49));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            37));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            50));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            38));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            51));
  _mm256_storeu_si256(compressed + 12, w0);
}

/* we are going to pack 256 14-bit values, touching 14 256-bit words, using 448
 * bytes */
static void avxpackblockmask14(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  14 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(16383);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            34));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            30));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            50));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            50));
  _mm256_storeu_si256(compressed + 13, w1);
}

/* we are going to pack 256 15-bit values, touching 15 256-bit words, using 480
 * bytes */
static void avxpackblockmask15(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  15 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(32767);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            45));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            41));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            37));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            33));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            29));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            25));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            17));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            47));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            43));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            39));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            1));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            31));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            27));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            23));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            34));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            49));
  _mm256_storeu_si256(compressed + 14, w0);
}

/* we are going to pack 256 16-bit values, touching 16 256-bit words, using 512
 * bytes */
static void avxpackblockmask16(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  16 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(65535);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            48));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            48));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            48));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            48));
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            48));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            48));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            48));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            48));
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            48));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            48));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            48));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            48));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            48));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            48));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            48));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            48));
  _mm256_storeu_si256(compressed + 15, w1);
}

/* we are going to pack 256 17-bit values, touching 17 256-bit words, using 544
 * bytes */
static void avxpackblockmask17(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  17 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(131071);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            21));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            29));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            46));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            37));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            41));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            45));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            19));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            23));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            27));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            1));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            39));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            43));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            30));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            47));
  _mm256_storeu_si256(compressed + 16, w0);
}

/* we are going to pack 256 18-bit values, touching 18 256-bit words, using 576
 * bytes */
static void avxpackblockmask18(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  18 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(262143);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            46));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            28));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            46));
  _mm256_storeu_si256(compressed + 17, w1);
}

/* we are going to pack 256 19-bit values, touching 19 256-bit words, using 608
 * bytes */
static void avxpackblockmask19(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  19 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(524287);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            43));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            17));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            41));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            39));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            13));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            25));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            37));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            11));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            23));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            26));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            45));
  _mm256_storeu_si256(compressed + 18, w0);
}

/* we are going to pack 256 20-bit values, touching 20 256-bit words, using 640
 * bytes */
static void avxpackblockmask20(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  20 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1048575);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            44));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            44));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            44));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            44));
  _mm256_storeu_si256(compressed + 19, w1);
}

/* we are going to pack 256 21-bit values, touching 21 256-bit words, using 672
 * bytes */
static void avxpackblockmask21(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  21 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(2097151);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            21));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            42));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            41));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            19));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            39));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            37));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            15));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            11));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            3));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            22));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            43));
  _mm256_storeu_si256(compressed + 20, w0);
}

/* we are going to pack 256 22-bit values, touching 22 256-bit words, using 704
 * bytes */
static void avxpackblockmask22(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  22 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(4194303);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            42));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            20));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            42));
  _mm256_storeu_si256(compressed + 21, w1);
}

/* we are going to pack 256 23-bit values, touching 23 256-bit words, using 736
 * bytes */
static void avxpackblockmask23(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  23 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(8388607);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 5));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            15));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            17));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            37));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            11));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            39));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            13));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            18));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            41));
  _mm256_storeu_si256(compressed + 22, w0);
}

/* we are going to pack 256 24-bit values, touching 24 256-bit words, using 768
 * bytes */
static void avxpackblockmask24(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  24 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(16777215);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            40));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            40));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            40));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            40));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            40));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            40));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            40));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            40));
  _mm256_storeu_si256(compressed + 23, w1);
}

/* we are going to pack 256 25-bit values, touching 25 256-bit words, using 800
 * bytes */
static void avxpackblockmask25(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  25 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(33554431);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            11));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            5));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            13));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            38));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            37));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            9));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            3));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            14));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            39));
  _mm256_storeu_si256(compressed + 24, w0);
}

/* we are going to pack 256 26-bit values, touching 26 256-bit words, using 832
 * bytes */
static void avxpackblockmask26(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  26 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(67108863);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            38));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            12));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            38));
  _mm256_storeu_si256(compressed + 25, w1);
}

/* we are going to pack 256 27-bit values, touching 27 256-bit words, using 864
 * bytes */
static void avxpackblockmask27(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  27 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(134217727);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 7));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            35));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            5));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            9));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            3));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            10));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            37));
  _mm256_storeu_si256(compressed + 26, w0);
}

/* we are going to pack 256 28-bit values, touching 28 256-bit words, using 896
 * bytes */
static void avxpackblockmask28(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  28 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(268435455);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            36));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            36));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            36));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            8));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            36));
  _mm256_storeu_si256(compressed + 27, w1);
}

/* we are going to pack 256 29-bit values, touching 29 256-bit words, using 928
 * bytes */
static void avxpackblockmask29(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  29 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(536870911);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 5));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            34));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            33));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            3));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            1));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            6));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            35));
  _mm256_storeu_si256(compressed + 28, w0);
}

/* we are going to pack 256 30-bit values, touching 30 256-bit words, using 960
 * bytes */
static void avxpackblockmask30(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  30 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1073741823);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            34));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            4));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            34));
  _mm256_storeu_si256(compressed + 29, w1);
}

/* we are going to pack 256 31-bit values, touching 31 256-bit words, using 992
 * bytes */
static void avxpackblockmask31(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  31 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(2147483647);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            31));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            1));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 32)),
                            32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 62)),
                            2));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            33));
  _mm256_storeu_si256(compressed + 30, w0);
}

/* we are going to pack 256 32-bit values, touching 32 256-bit words, using 1024
 * bytes */
static void avxpackblockmask32(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  32 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(4294967295);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 1)),
                            32));
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            32));
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            32));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            32));
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            32));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            32));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            32));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            32));
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            32));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            32));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            32));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            32));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            32));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            32));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            32));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            32));
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            32));
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            32));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            32));
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            32));
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            32));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            32));
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            32));
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            32));
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            32));
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            32));
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            32));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            32));
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            32));
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            32));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            32));
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            32));
  _mm256_storeu_si256(compressed + 31, w1);
}

/* we are going to pack 256 33-bit values, touching 33 256-bit words, using 1056
 * bytes */
static void avxpackblockmask33(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  33 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(8589934591);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            30));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            29));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            31));
  _mm256_storeu_si256(compressed + 32, w0);
}

/* we are going to pack 256 34-bit values, touching 34 256-bit words, using 1088
 * bytes */
static void avxpackblockmask34(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  34 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(17179869183);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            30));
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            30));
  _mm256_storeu_si256(compressed + 33, w1);
}

/* we are going to pack 256 35-bit values, touching 35 256-bit words, using 1120
 * bytes */
static void avxpackblockmask35(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  35 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(34359738367);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            27));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            29));
  _mm256_storeu_si256(compressed + 34, w0);
}

/* we are going to pack 256 36-bit values, touching 36 256-bit words, using 1152
 * bytes */
static void avxpackblockmask36(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  36 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(68719476735);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            28));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            28));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            28));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            28));
  _mm256_storeu_si256(compressed + 35, w1);
}

/* we are going to pack 256 37-bit values, touching 37 256-bit words, using 1184
 * bytes */
static void avxpackblockmask37(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  37 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(137438953471);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            26));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            25));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            27));
  _mm256_storeu_si256(compressed + 36, w0);
}

/* we are going to pack 256 38-bit values, touching 38 256-bit words, using 1216
 * bytes */
static void avxpackblockmask38(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  38 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(274877906943);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            26));
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            26));
  _mm256_storeu_si256(compressed + 37, w1);
}

/* we are going to pack 256 39-bit values, touching 39 256-bit words, using 1248
 * bytes */
static void avxpackblockmask39(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  39 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(549755813887);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            23));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            25));
  _mm256_storeu_si256(compressed + 38, w0);
}

/* we are going to pack 256 40-bit values, touching 40 256-bit words, using 1280
 * bytes */
static void avxpackblockmask40(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  40 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1099511627775);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            24));
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            24));
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            24));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            24));
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            24));
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            24));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            24));
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            24));
  _mm256_storeu_si256(compressed + 39, w1);
}

/* we are going to pack 256 41-bit values, touching 41 256-bit words, using 1312
 * bytes */
static void avxpackblockmask41(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  41 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(2199023255551);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            21));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            22));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            23));
  _mm256_storeu_si256(compressed + 40, w0);
}

/* we are going to pack 256 42-bit values, touching 42 256-bit words, using 1344
 * bytes */
static void avxpackblockmask42(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  42 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(4398046511103);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 2)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            22));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 61)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            22));
  _mm256_storeu_si256(compressed + 41, w1);
}

/* we are going to pack 256 43-bit values, touching 43 256-bit words, using 1376
 * bytes */
static void avxpackblockmask43(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  43 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(8796093022207);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            19));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            21));
  _mm256_storeu_si256(compressed + 42, w0);
}

/* we are going to pack 256 44-bit values, touching 44 256-bit words, using 1408
 * bytes */
static void avxpackblockmask44(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  44 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(17592186044415);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            20));
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            20));
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            20));
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            20));
  _mm256_storeu_si256(compressed + 43, w1);
}

/* we are going to pack 256 45-bit values, touching 45 256-bit words, using 1440
 * bytes */
static void avxpackblockmask45(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  45 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(35184372088831);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)), 7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 16)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 20)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            18));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            17));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            19));
  _mm256_storeu_si256(compressed + 44, w0);
}

/* we are going to pack 256 46-bit values, touching 46 256-bit words, using 1472
 * bytes */
static void avxpackblockmask46(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  46 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(70368744177663);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            18));
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            18));
  _mm256_storeu_si256(compressed + 45, w1);
}

/* we are going to pack 256 47-bit values, touching 47 256-bit words, using 1504
 * bytes */
static void avxpackblockmask47(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  47 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(140737488355327);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 19));
  w0 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 30)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 33)),
                            15));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 45));
  w0 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 48)),
                            16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 21));
  w0 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 60)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 45, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            17));
  _mm256_storeu_si256(compressed + 46, w0);
}

/* we are going to pack 256 48-bit values, touching 48 256-bit words, using 1536
 * bytes */
static void avxpackblockmask48(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  48 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(281474976710655);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 3)),
                            16));
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)),
                            16));
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            16));
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            16));
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            16));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            16));
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            16));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            16));
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            16));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            16));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 43)),
                            16));
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            16));
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            16));
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            16));
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            16));
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            16));
  _mm256_storeu_si256(compressed + 47, w1);
}

/* we are going to pack 256 49-bit values, touching 49 256-bit words, using 1568
 * bytes */
static void avxpackblockmask49(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  49 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(562949953421311);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 8)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            13));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            14));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            15));
  _mm256_storeu_si256(compressed + 48, w0);
}

/* we are going to pack 256 50-bit values, touching 50 256-bit words, using 1600
 * bytes */
static void avxpackblockmask50(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  50 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1125899906842623);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)), 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 13)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 22)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            14));
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 41)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 50)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 45, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 48, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            14));
  _mm256_storeu_si256(compressed + 49, w1);
}

/* we are going to pack 256 51-bit values, touching 51 256-bit words, using 1632
 * bytes */
static void avxpackblockmask51(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  51 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(2251799813685247);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 4)),
                            12));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)),
                            11));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 24)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 59)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 49, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            13));
  _mm256_storeu_si256(compressed + 50, w0);
}

/* we are going to pack 256 52-bit values, touching 52 256-bit words, using 1664
 * bytes */
static void avxpackblockmask52(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  52 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(4503599627370495);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            12));
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 26)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            12));
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 37)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            12));
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 50, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            12));
  _mm256_storeu_si256(compressed + 51, w1);
}

/* we are going to pack 256 53-bit values, touching 53 256-bit words, using 1696
 * bytes */
static void avxpackblockmask53(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  53 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(9007199254740991);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 5)), 9));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 11)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 17)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 29)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 21));
  w0 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 34)),
                            10));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 40)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 46)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 52)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 57));
  w0 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 58)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 51, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            11));
  _mm256_storeu_si256(compressed + 52, w0);
}

/* we are going to pack 256 54-bit values, touching 54 256-bit words, using 1728
 * bytes */
static void avxpackblockmask54(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  54 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(18014398509481983);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_or_si256(
      w1,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 6)), 4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 19)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            10));
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 44)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 57)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 52, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            10));
  _mm256_storeu_si256(compressed + 53, w1);
}

/* we are going to pack 256 55-bit values, touching 55 256-bit words, using 1760
 * bytes */
static void avxpackblockmask55(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  55 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(36028797018963967);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 14)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 49));
  w0 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 28)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 35)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 15));
  w0 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 49)),
                            7));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 56)),
                            8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 53, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            9));
  _mm256_storeu_si256(compressed + 54, w0);
}

/* we are going to pack 256 56-bit values, touching 56 256-bit words, using 1792
 * bytes */
static void avxpackblockmask56(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  56 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(72057594037927935);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 7)), 8));
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            8));
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 23)),
                            8));
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            8));
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 39)),
                            8));
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            8));
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 55)),
                            8));
  _mm256_storeu_si256(compressed + 48, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 54, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            8));
  _mm256_storeu_si256(compressed + 55, w1);
}

/* we are going to pack 256 57-bit values, touching 57 256-bit words, using 1824
 * bytes */
static void avxpackblockmask57(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  57 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(144115188075855871);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_or_si256(
      w0,
      _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 9)), 1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 37));
  w0 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 9));
  w0 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 18)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 27)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 39));
  w0 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 25));
  w0 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 36)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 45)),
                            5));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 55));
  w0 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 27));
  w0 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 54)),
                            6));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 55, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            7));
  _mm256_storeu_si256(compressed + 56, w0);
}

/* we are going to pack 256 58-bit values, touching 58 256-bit words, using 1856
 * bytes */
static void avxpackblockmask58(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  58 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(288230376151711743);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 10));
  w1 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 10)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            6));
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 53)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 56, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            6));
  _mm256_storeu_si256(compressed + 57, w1);
}

/* we are going to pack 256 59-bit values, touching 59 256-bit words, using 1888
 * bytes */
static void avxpackblockmask59(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  59 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(576460752303423487);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 9));
  w1 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 12)),
                            4));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 63));
  w0 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 43));
  w0 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 33));
  w0 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 13));
  w0 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 25)),
                            3));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 7));
  w1 = _mm256_srli_epi64(tmp, 57);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 38)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 61));
  w0 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 51));
  w0 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 31));
  w0 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 21));
  w0 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 6));
  w1 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 51)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 57, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            5));
  _mm256_storeu_si256(compressed + 58, w0);
}

/* we are going to pack 256 60-bit values, touching 60 256-bit words, using 1920
 * bytes */
static void avxpackblockmask60(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  60 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(1152921504606846975);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 15)),
                            4));
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            4));
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 47)),
                            4));
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 58, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            4));
  _mm256_storeu_si256(compressed + 59, w1);
}

/* we are going to pack 256 61-bit values, touching 61 256-bit words, using 1952
 * bytes */
static void avxpackblockmask61(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  61 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(2305843009213693951);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 13));
  w1 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 7));
  w1 = _mm256_srli_epi64(tmp, 57);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 4));
  w0 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 21)),
                            1));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 59));
  w0 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 53));
  w0 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 47));
  w0 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 41));
  w0 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 35));
  w0 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 29));
  w0 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 23));
  w0 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 17));
  w0 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 11));
  w0 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 5));
  w0 = _mm256_srli_epi64(tmp, 59);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 42)),
                            2));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 9));
  w1 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 58, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 6));
  w0 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 59, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            3));
  _mm256_storeu_si256(compressed + 60, w0);
}

/* we are going to pack 256 62-bit values, touching 62 256-bit words, using 1984
 * bytes */
static void avxpackblockmask62(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  62 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(4611686018427387903);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 62));
  w1 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 58));
  w1 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 54));
  w1 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 50));
  w1 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 46));
  w1 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 42));
  w1 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 38));
  w1 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 34));
  w1 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 30));
  w1 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 26));
  w1 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 22));
  w1 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 18));
  w1 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 14));
  w1 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 10));
  w1 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 6));
  w1 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 4));
  w0 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 31)),
                            2));
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 60));
  w1 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 56));
  w1 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 52));
  w1 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 48));
  w1 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 44));
  w1 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 40));
  w1 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 36));
  w1 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 32));
  w1 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 28));
  w1 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 24));
  w1 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 20));
  w1 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 16));
  w1 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 12));
  w1 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 8));
  w1 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 58, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 6));
  w0 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 59, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 4));
  w1 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 60, w0);
  w1 = _mm256_or_si256(
      w1, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            2));
  _mm256_storeu_si256(compressed + 61, w1);
}

/* we are going to pack 256 63-bit values, touching 63 256-bit words, using 2016
 * bytes */
static void avxpackblockmask63(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  63 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  const __m256i mask = _mm256_set1_epi64x(9223372036854775807);
  __m256i tmp; /* used to store inputs at word boundary */
  w0 = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 0));
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 1));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 63));
  w1 = _mm256_srli_epi64(tmp, 1);
  _mm256_storeu_si256(compressed + 0, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 2));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 62));
  w0 = _mm256_srli_epi64(tmp, 2);
  _mm256_storeu_si256(compressed + 1, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 3));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 61));
  w1 = _mm256_srli_epi64(tmp, 3);
  _mm256_storeu_si256(compressed + 2, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 4));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 60));
  w0 = _mm256_srli_epi64(tmp, 4);
  _mm256_storeu_si256(compressed + 3, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 5));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 59));
  w1 = _mm256_srli_epi64(tmp, 5);
  _mm256_storeu_si256(compressed + 4, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 6));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 58));
  w0 = _mm256_srli_epi64(tmp, 6);
  _mm256_storeu_si256(compressed + 5, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 7));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 57));
  w1 = _mm256_srli_epi64(tmp, 7);
  _mm256_storeu_si256(compressed + 6, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 8));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 56));
  w0 = _mm256_srli_epi64(tmp, 8);
  _mm256_storeu_si256(compressed + 7, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 9));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 55));
  w1 = _mm256_srli_epi64(tmp, 9);
  _mm256_storeu_si256(compressed + 8, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 10));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 54));
  w0 = _mm256_srli_epi64(tmp, 10);
  _mm256_storeu_si256(compressed + 9, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 11));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 53));
  w1 = _mm256_srli_epi64(tmp, 11);
  _mm256_storeu_si256(compressed + 10, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 12));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 52));
  w0 = _mm256_srli_epi64(tmp, 12);
  _mm256_storeu_si256(compressed + 11, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 13));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 51));
  w1 = _mm256_srli_epi64(tmp, 13);
  _mm256_storeu_si256(compressed + 12, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 14));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 50));
  w0 = _mm256_srli_epi64(tmp, 14);
  _mm256_storeu_si256(compressed + 13, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 15));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 49));
  w1 = _mm256_srli_epi64(tmp, 15);
  _mm256_storeu_si256(compressed + 14, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 16));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 48));
  w0 = _mm256_srli_epi64(tmp, 16);
  _mm256_storeu_si256(compressed + 15, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 17));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 47));
  w1 = _mm256_srli_epi64(tmp, 17);
  _mm256_storeu_si256(compressed + 16, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 18));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 46));
  w0 = _mm256_srli_epi64(tmp, 18);
  _mm256_storeu_si256(compressed + 17, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 19));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 45));
  w1 = _mm256_srli_epi64(tmp, 19);
  _mm256_storeu_si256(compressed + 18, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 20));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 44));
  w0 = _mm256_srli_epi64(tmp, 20);
  _mm256_storeu_si256(compressed + 19, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 21));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 43));
  w1 = _mm256_srli_epi64(tmp, 21);
  _mm256_storeu_si256(compressed + 20, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 22));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 42));
  w0 = _mm256_srli_epi64(tmp, 22);
  _mm256_storeu_si256(compressed + 21, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 23));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 41));
  w1 = _mm256_srli_epi64(tmp, 23);
  _mm256_storeu_si256(compressed + 22, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 24));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 40));
  w0 = _mm256_srli_epi64(tmp, 24);
  _mm256_storeu_si256(compressed + 23, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 25));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 39));
  w1 = _mm256_srli_epi64(tmp, 25);
  _mm256_storeu_si256(compressed + 24, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 26));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 38));
  w0 = _mm256_srli_epi64(tmp, 26);
  _mm256_storeu_si256(compressed + 25, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 27));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 37));
  w1 = _mm256_srli_epi64(tmp, 27);
  _mm256_storeu_si256(compressed + 26, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 28));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 36));
  w0 = _mm256_srli_epi64(tmp, 28);
  _mm256_storeu_si256(compressed + 27, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 29));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 35));
  w1 = _mm256_srli_epi64(tmp, 29);
  _mm256_storeu_si256(compressed + 28, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 30));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 34));
  w0 = _mm256_srli_epi64(tmp, 30);
  _mm256_storeu_si256(compressed + 29, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 31));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 33));
  w1 = _mm256_srli_epi64(tmp, 31);
  _mm256_storeu_si256(compressed + 30, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 32));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 32));
  w0 = _mm256_srli_epi64(tmp, 32);
  _mm256_storeu_si256(compressed + 31, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 33));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 31));
  w1 = _mm256_srli_epi64(tmp, 33);
  _mm256_storeu_si256(compressed + 32, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 34));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 30));
  w0 = _mm256_srli_epi64(tmp, 34);
  _mm256_storeu_si256(compressed + 33, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 35));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 29));
  w1 = _mm256_srli_epi64(tmp, 35);
  _mm256_storeu_si256(compressed + 34, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 36));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 28));
  w0 = _mm256_srli_epi64(tmp, 36);
  _mm256_storeu_si256(compressed + 35, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 37));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 27));
  w1 = _mm256_srli_epi64(tmp, 37);
  _mm256_storeu_si256(compressed + 36, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 38));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 26));
  w0 = _mm256_srli_epi64(tmp, 38);
  _mm256_storeu_si256(compressed + 37, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 39));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 25));
  w1 = _mm256_srli_epi64(tmp, 39);
  _mm256_storeu_si256(compressed + 38, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 40));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 24));
  w0 = _mm256_srli_epi64(tmp, 40);
  _mm256_storeu_si256(compressed + 39, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 41));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 23));
  w1 = _mm256_srli_epi64(tmp, 41);
  _mm256_storeu_si256(compressed + 40, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 42));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 22));
  w0 = _mm256_srli_epi64(tmp, 42);
  _mm256_storeu_si256(compressed + 41, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 43));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 21));
  w1 = _mm256_srli_epi64(tmp, 43);
  _mm256_storeu_si256(compressed + 42, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 44));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 20));
  w0 = _mm256_srli_epi64(tmp, 44);
  _mm256_storeu_si256(compressed + 43, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 45));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 19));
  w1 = _mm256_srli_epi64(tmp, 45);
  _mm256_storeu_si256(compressed + 44, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 46));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 18));
  w0 = _mm256_srli_epi64(tmp, 46);
  _mm256_storeu_si256(compressed + 45, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 47));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 17));
  w1 = _mm256_srli_epi64(tmp, 47);
  _mm256_storeu_si256(compressed + 46, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 48));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 16));
  w0 = _mm256_srli_epi64(tmp, 48);
  _mm256_storeu_si256(compressed + 47, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 49));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 15));
  w1 = _mm256_srli_epi64(tmp, 49);
  _mm256_storeu_si256(compressed + 48, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 50));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 14));
  w0 = _mm256_srli_epi64(tmp, 50);
  _mm256_storeu_si256(compressed + 49, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 51));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 13));
  w1 = _mm256_srli_epi64(tmp, 51);
  _mm256_storeu_si256(compressed + 50, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 52));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 12));
  w0 = _mm256_srli_epi64(tmp, 52);
  _mm256_storeu_si256(compressed + 51, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 53));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 11));
  w1 = _mm256_srli_epi64(tmp, 53);
  _mm256_storeu_si256(compressed + 52, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 54));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 10));
  w0 = _mm256_srli_epi64(tmp, 54);
  _mm256_storeu_si256(compressed + 53, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 55));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 9));
  w1 = _mm256_srli_epi64(tmp, 55);
  _mm256_storeu_si256(compressed + 54, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 56));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 8));
  w0 = _mm256_srli_epi64(tmp, 56);
  _mm256_storeu_si256(compressed + 55, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 57));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 7));
  w1 = _mm256_srli_epi64(tmp, 57);
  _mm256_storeu_si256(compressed + 56, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 58));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 6));
  w0 = _mm256_srli_epi64(tmp, 58);
  _mm256_storeu_si256(compressed + 57, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 59));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 5));
  w1 = _mm256_srli_epi64(tmp, 59);
  _mm256_storeu_si256(compressed + 58, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 60));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 4));
  w0 = _mm256_srli_epi64(tmp, 60);
  _mm256_storeu_si256(compressed + 59, w1);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 61));
  w0 = _mm256_or_si256(w0, _mm256_slli_epi64(tmp, 3));
  w1 = _mm256_srli_epi64(tmp, 61);
  _mm256_storeu_si256(compressed + 60, w0);
  tmp = _mm256_and_si256(mask, _mm256_lddqu_si256(in + 62));
  w1 = _mm256_or_si256(w1, _mm256_slli_epi64(tmp, 2));
  w0 = _mm256_srli_epi64(tmp, 62);
  _mm256_storeu_si256(compressed + 61, w1);
  w0 = _mm256_or_si256(
      w0, _mm256_slli_epi64(_mm256_and_si256(mask, _mm256_lddqu_si256(in + 63)),
                            1));
  _mm256_storeu_si256(compressed + 62, w0);
}

/* we are going to pack 256 64-bit values, touching 64 256-bit words, using 2048
 * bytes */
static void avxpackblockmask64(const u64 *pin, __m256i *compressed) {
  /* we are going to touch  64 256-bit words */
  __m256i w0, w1;
  const __m256i *in = (const __m256i *)pin;
  w0 = _mm256_lddqu_si256(in + 0);
  _mm256_storeu_si256(compressed + 0, w0);
  w1 = _mm256_lddqu_si256(in + 1);
  _mm256_storeu_si256(compressed + 1, w1);
  w0 = _mm256_lddqu_si256(in + 2);
  _mm256_storeu_si256(compressed + 2, w0);
  w1 = _mm256_lddqu_si256(in + 3);
  _mm256_storeu_si256(compressed + 3, w1);
  w0 = _mm256_lddqu_si256(in + 4);
  _mm256_storeu_si256(compressed + 4, w0);
  w1 = _mm256_lddqu_si256(in + 5);
  _mm256_storeu_si256(compressed + 5, w1);
  w0 = _mm256_lddqu_si256(in + 6);
  _mm256_storeu_si256(compressed + 6, w0);
  w1 = _mm256_lddqu_si256(in + 7);
  _mm256_storeu_si256(compressed + 7, w1);
  w0 = _mm256_lddqu_si256(in + 8);
  _mm256_storeu_si256(compressed + 8, w0);
  w1 = _mm256_lddqu_si256(in + 9);
  _mm256_storeu_si256(compressed + 9, w1);
  w0 = _mm256_lddqu_si256(in + 10);
  _mm256_storeu_si256(compressed + 10, w0);
  w1 = _mm256_lddqu_si256(in + 11);
  _mm256_storeu_si256(compressed + 11, w1);
  w0 = _mm256_lddqu_si256(in + 12);
  _mm256_storeu_si256(compressed + 12, w0);
  w1 = _mm256_lddqu_si256(in + 13);
  _mm256_storeu_si256(compressed + 13, w1);
  w0 = _mm256_lddqu_si256(in + 14);
  _mm256_storeu_si256(compressed + 14, w0);
  w1 = _mm256_lddqu_si256(in + 15);
  _mm256_storeu_si256(compressed + 15, w1);
  w0 = _mm256_lddqu_si256(in + 16);
  _mm256_storeu_si256(compressed + 16, w0);
  w1 = _mm256_lddqu_si256(in + 17);
  _mm256_storeu_si256(compressed + 17, w1);
  w0 = _mm256_lddqu_si256(in + 18);
  _mm256_storeu_si256(compressed + 18, w0);
  w1 = _mm256_lddqu_si256(in + 19);
  _mm256_storeu_si256(compressed + 19, w1);
  w0 = _mm256_lddqu_si256(in + 20);
  _mm256_storeu_si256(compressed + 20, w0);
  w1 = _mm256_lddqu_si256(in + 21);
  _mm256_storeu_si256(compressed + 21, w1);
  w0 = _mm256_lddqu_si256(in + 22);
  _mm256_storeu_si256(compressed + 22, w0);
  w1 = _mm256_lddqu_si256(in + 23);
  _mm256_storeu_si256(compressed + 23, w1);
  w0 = _mm256_lddqu_si256(in + 24);
  _mm256_storeu_si256(compressed + 24, w0);
  w1 = _mm256_lddqu_si256(in + 25);
  _mm256_storeu_si256(compressed + 25, w1);
  w0 = _mm256_lddqu_si256(in + 26);
  _mm256_storeu_si256(compressed + 26, w0);
  w1 = _mm256_lddqu_si256(in + 27);
  _mm256_storeu_si256(compressed + 27, w1);
  w0 = _mm256_lddqu_si256(in + 28);
  _mm256_storeu_si256(compressed + 28, w0);
  w1 = _mm256_lddqu_si256(in + 29);
  _mm256_storeu_si256(compressed + 29, w1);
  w0 = _mm256_lddqu_si256(in + 30);
  _mm256_storeu_si256(compressed + 30, w0);
  w1 = _mm256_lddqu_si256(in + 31);
  _mm256_storeu_si256(compressed + 31, w1);
  w0 = _mm256_lddqu_si256(in + 32);
  _mm256_storeu_si256(compressed + 32, w0);
  w1 = _mm256_lddqu_si256(in + 33);
  _mm256_storeu_si256(compressed + 33, w1);
  w0 = _mm256_lddqu_si256(in + 34);
  _mm256_storeu_si256(compressed + 34, w0);
  w1 = _mm256_lddqu_si256(in + 35);
  _mm256_storeu_si256(compressed + 35, w1);
  w0 = _mm256_lddqu_si256(in + 36);
  _mm256_storeu_si256(compressed + 36, w0);
  w1 = _mm256_lddqu_si256(in + 37);
  _mm256_storeu_si256(compressed + 37, w1);
  w0 = _mm256_lddqu_si256(in + 38);
  _mm256_storeu_si256(compressed + 38, w0);
  w1 = _mm256_lddqu_si256(in + 39);
  _mm256_storeu_si256(compressed + 39, w1);
  w0 = _mm256_lddqu_si256(in + 40);
  _mm256_storeu_si256(compressed + 40, w0);
  w1 = _mm256_lddqu_si256(in + 41);
  _mm256_storeu_si256(compressed + 41, w1);
  w0 = _mm256_lddqu_si256(in + 42);
  _mm256_storeu_si256(compressed + 42, w0);
  w1 = _mm256_lddqu_si256(in + 43);
  _mm256_storeu_si256(compressed + 43, w1);
  w0 = _mm256_lddqu_si256(in + 44);
  _mm256_storeu_si256(compressed + 44, w0);
  w1 = _mm256_lddqu_si256(in + 45);
  _mm256_storeu_si256(compressed + 45, w1);
  w0 = _mm256_lddqu_si256(in + 46);
  _mm256_storeu_si256(compressed + 46, w0);
  w1 = _mm256_lddqu_si256(in + 47);
  _mm256_storeu_si256(compressed + 47, w1);
  w0 = _mm256_lddqu_si256(in + 48);
  _mm256_storeu_si256(compressed + 48, w0);
  w1 = _mm256_lddqu_si256(in + 49);
  _mm256_storeu_si256(compressed + 49, w1);
  w0 = _mm256_lddqu_si256(in + 50);
  _mm256_storeu_si256(compressed + 50, w0);
  w1 = _mm256_lddqu_si256(in + 51);
  _mm256_storeu_si256(compressed + 51, w1);
  w0 = _mm256_lddqu_si256(in + 52);
  _mm256_storeu_si256(compressed + 52, w0);
  w1 = _mm256_lddqu_si256(in + 53);
  _mm256_storeu_si256(compressed + 53, w1);
  w0 = _mm256_lddqu_si256(in + 54);
  _mm256_storeu_si256(compressed + 54, w0);
  w1 = _mm256_lddqu_si256(in + 55);
  _mm256_storeu_si256(compressed + 55, w1);
  w0 = _mm256_lddqu_si256(in + 56);
  _mm256_storeu_si256(compressed + 56, w0);
  w1 = _mm256_lddqu_si256(in + 57);
  _mm256_storeu_si256(compressed + 57, w1);
  w0 = _mm256_lddqu_si256(in + 58);
  _mm256_storeu_si256(compressed + 58, w0);
  w1 = _mm256_lddqu_si256(in + 59);
  _mm256_storeu_si256(compressed + 59, w1);
  w0 = _mm256_lddqu_si256(in + 60);
  _mm256_storeu_si256(compressed + 60, w0);
  w1 = _mm256_lddqu_si256(in + 61);
  _mm256_storeu_si256(compressed + 61, w1);
  w0 = _mm256_lddqu_si256(in + 62);
  _mm256_storeu_si256(compressed + 62, w0);
  w1 = _mm256_lddqu_si256(in + 63);
  _mm256_storeu_si256(compressed + 63, w1);
}

static void avxunpackblock0(const __m256i *compressed, u64 *pout) {
  (void)compressed;
  memset(pout, 0, 256);
}

/* we packed 256 1-bit values, touching 1 256-bit words, using 32 bytes */
static void avxunpackblock1(const __m256i *compressed, u64 *pout) {
  /* we are going to access  1 256-bit word */
  __m256i w0;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 33)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 41)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 47)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 49)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 51)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 53)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 55)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 56)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 57)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 58)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 59)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 60)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 61)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 62)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 63));
}

/* we packed 256 2-bit values, touching 2 256-bit words, using 64 bytes */
static void avxunpackblock2(const __m256i *compressed, u64 *pout) {
  /* we are going to access  2 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(3);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 56)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 58)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 60)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 62));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 50)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 52)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 54)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 56)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 58)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 60)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 62));
}

/* we packed 256 3-bit values, touching 3 256-bit words, using 96 bytes */
static void avxunpackblock3(const __m256i *compressed, u64 *pout) {
  /* we are going to access  3 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(7);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 33)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 51)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 57)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 60)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 41)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 47)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 50)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 53)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 56)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 59)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 49)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 55)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 58)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 61));
}

/* we packed 256 4-bit values, touching 4 256-bit words, using 128 bytes */
static void avxunpackblock4(const __m256i *compressed, u64 *pout) {
  /* we are going to access  4 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(15);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 56)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 60));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 52)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 56)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 60));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 56)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 60));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 52)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 56)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 60));
}

/* we packed 256 5-bit values, touching 5 256-bit words, using 160 bytes */
static void avxunpackblock5(const __m256i *compressed, u64 *pout) {
  /* we are going to access  5 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(31);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 55)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 41)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 51)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 56)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 47)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 57)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 43)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 53)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 58)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 49)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 59));
}

/* we packed 256 6-bit values, touching 6 256-bit words, using 192 bytes */
static void avxunpackblock6(const __m256i *compressed, u64 *pout) {
  /* we are going to access  6 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(63);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 50)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 56)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 58));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 54)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 56)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 52)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 58));
}

/* we packed 256 7-bit values, touching 7 256-bit words, using 224 bytes */
static void avxunpackblock7(const __m256i *compressed, u64 *pout) {
  /* we are going to access  7 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(127);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 49)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 56)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 27)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 41)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 55)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 33)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 47)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 39)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 53)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 37)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 51)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 57));
}

/* we packed 256 8-bit values, touching 8 256-bit words, using 256 bytes */
static void avxunpackblock8(const __m256i *compressed, u64 *pout) {
  /* we are going to access  8 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(255);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w0, 56));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 56));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w0, 56));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 56));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w0, 56));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 56));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w0, 56));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 56));
}

/* we packed 256 9-bit values, touching 9 256-bit words, using 288 bytes */
static void avxunpackblock9(const __m256i *compressed, u64 *pout) {
  /* we are going to access  9 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(511);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 54)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 53)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 15)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 51)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 41)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 49)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 47)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 55));
}

/* we packed 256 10-bit values, touching 10 256-bit words, using 320 bytes */
static void avxunpackblock10(const __m256i *compressed, u64 *pout) {
  /* we are going to access  10 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1023);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 50)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 54));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 50)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 52)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 54));
}

/* we packed 256 11-bit values, touching 11 256-bit words, using 352 bytes */
static void avxunpackblock11(const __m256i *compressed, u64 *pout) {
  /* we are going to access  11 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(2047);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 33)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 57),
                                             _mm256_slli_epi64(w0, 7))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 39)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 50)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 41)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 52)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 43)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 47)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 49)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 7)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 51)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 53));
}

/* we packed 256 12-bit values, touching 12 256-bit words, using 384 bytes */
static void avxunpackblock12(const __m256i *compressed, u64 *pout) {
  /* we are going to access  12 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(4095);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 52));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 52));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 52));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 52));
}

/* we packed 256 13-bit values, touching 13 256-bit words, using 416 bytes */
static void avxunpackblock13(const __m256i *compressed, u64 *pout) {
  /* we are going to access  13 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(8191);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 27)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 41)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 57),
                                             _mm256_slli_epi64(w0, 7))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 7)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 47)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 49)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 37)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 50)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 51));
}

/* we packed 256 14-bit values, touching 14 256-bit words, using 448 bytes */
static void avxunpackblock14(const __m256i *compressed, u64 *pout) {
  /* we are going to access  14 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(16383);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 50));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 48)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 46)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 50));
}

/* we packed 256 15-bit values, touching 15 256-bit words, using 480 bytes */
static void avxunpackblock15(const __m256i *compressed, u64 *pout) {
  /* we are going to access  15 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(32767);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 45)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 41)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 48)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 47)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 39)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 49));
}

/* we packed 256 16-bit values, touching 16 256-bit words, using 512 bytes */
static void avxunpackblock16(const __m256i *compressed, u64 *pout) {
  /* we are going to access  16 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(65535);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 3, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(out + 4, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 11, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 12, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 19, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 20, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 27, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 28, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 35, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 36, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 43, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(out + 44, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 51, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(out + 52, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w1, 48));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  _mm256_storeu_si256(out + 59, _mm256_srli_epi64(w0, 48));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 60, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 48));
}

/* we packed 256 17-bit values, touching 17 256-bit words, using 544 bytes */
static void avxunpackblock17(const __m256i *compressed, u64 *pout) {
  /* we are going to access  17 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(131071);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 46)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 33)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 37)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 41)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 45)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 27)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 43)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 47));
}

/* we packed 256 18-bit values, touching 18 256-bit words, using 576 bytes */
static void avxunpackblock18(const __m256i *compressed, u64 *pout) {
  /* we are going to access  18 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(262143);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 44)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 46));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 46));
}

/* we packed 256 19-bit values, touching 19 256-bit words, using 608 bytes */
static void avxunpackblock19(const __m256i *compressed, u64 *pout) {
  /* we are going to access  19 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(524287);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 43)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 41)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 27)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 39)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 44)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 37)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 42)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 45));
}

/* we packed 256 20-bit values, touching 20 256-bit words, using 640 bytes */
static void avxunpackblock20(const __m256i *compressed, u64 *pout) {
  /* we are going to access  20 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1048575);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 44));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 44));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 44));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 44));
}

/* we packed 256 21-bit values, touching 21 256-bit words, using 672 bytes */
static void avxunpackblock21(const __m256i *compressed, u64 *pout) {
  /* we are going to access  21 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(2097151);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 42)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 41)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 39)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 37)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 27)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 43));
}

/* we packed 256 22-bit values, touching 22 256-bit words, using 704 bytes */
static void avxunpackblock22(const __m256i *compressed, u64 *pout) {
  /* we are going to access  22 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(4194303);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 40)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 42));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 42));
}

/* we packed 256 23-bit values, touching 23 256-bit words, using 736 bytes */
static void avxunpackblock23(const __m256i *compressed, u64 *pout) {
  /* we are going to access  23 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(8388607);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 33)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 15)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 38)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 35)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 40)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 37)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 39)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 49),
                                             _mm256_slli_epi64(w0, 15))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 41));
}

/* we packed 256 24-bit values, touching 24 256-bit words, using 768 bytes */
static void avxunpackblock24(const __m256i *compressed, u64 *pout) {
  /* we are going to access  24 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(16777215);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w0, 40));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 40));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w0, 40));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 40));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w0, 40));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 40));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w0, 40));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 40));
}

/* we packed 256 25-bit values, touching 25 256-bit words, using 800 bytes */
static void avxunpackblock25(const __m256i *compressed, u64 *pout) {
  /* we are going to access  25 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(33554431);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 27)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 38)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 49),
                                             _mm256_slli_epi64(w0, 15))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 15)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 37)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 39));
}

/* we packed 256 26-bit values, touching 26 256-bit words, using 832 bytes */
static void avxunpackblock26(const __m256i *compressed, u64 *pout) {
  /* we are going to access  26 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(67108863);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 38));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 34)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 36)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 38));
}

/* we packed 256 27-bit values, touching 27 256-bit words, using 864 bytes */
static void avxunpackblock27(const __m256i *compressed, u64 *pout) {
  /* we are going to access  27 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(134217727);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 35)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 36)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 37));
}

/* we packed 256 28-bit values, touching 28 256-bit words, using 896 bytes */
static void avxunpackblock28(const __m256i *compressed, u64 *pout) {
  /* we are going to access  28 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(268435455);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 36));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 36));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 36));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 36));
}

/* we packed 256 29-bit values, touching 29 256-bit words, using 928 bytes */
static void avxunpackblock29(const __m256i *compressed, u64 *pout) {
  /* we are going to access  29 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(536870911);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 29)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 34)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 57),
                                             _mm256_slli_epi64(w0, 7))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 33)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 31)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 7)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 35));
}

/* we packed 256 30-bit values, touching 30 256-bit words, using 960 bytes */
static void avxunpackblock30(const __m256i *compressed, u64 *pout) {
  /* we are going to access  30 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1073741823);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 34));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 32)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 34));
}

/* we packed 256 31-bit values, touching 31 256-bit words, using 992 bytes */
static void avxunpackblock31(const __m256i *compressed, u64 *pout) {
  /* we are going to access  31 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(2147483647);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 31)));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  _mm256_storeu_si256(out + 31,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  _mm256_storeu_si256(out + 32,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 32)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 30)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  _mm256_storeu_si256(out + 62,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 33));
}

/* we packed 256 32-bit values, touching 32 256-bit words, using 1024 bytes */
static void avxunpackblock32(const __m256i *compressed, u64 *pout) {
  /* we are going to access  32 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(4294967295);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 1, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(out + 2, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 3, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(out + 4, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 5, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 6, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 9, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 10, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 11, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 12, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 13, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 14, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 17, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 18, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 19, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(out + 20, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 21, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(out + 22, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 25, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(out + 26, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 27, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(out + 28, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 29, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 30, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 33, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(out + 34, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 35, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(out + 36, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 37, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(out + 38, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 41, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 42, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 43, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(out + 44, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 45, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(out + 46, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 49, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(out + 50, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 51, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(out + 52, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 53, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(out + 54, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 57, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(out + 58, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 59, _mm256_srli_epi64(w1, 32));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(out + 60, _mm256_and_si256(mask, w0));
  _mm256_storeu_si256(out + 61, _mm256_srli_epi64(w0, 32));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(out + 62, _mm256_and_si256(mask, w1));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 32));
}

/* we packed 256 33-bit values, touching 33 256-bit words, using 1056 bytes */
static void avxunpackblock33(const __m256i *compressed, u64 *pout) {
  /* we are going to access  33 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(8589934591);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 30)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 29)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 31));
}

/* we packed 256 34-bit values, touching 34 256-bit words, using 1088 bytes */
static void avxunpackblock34(const __m256i *compressed, u64 *pout) {
  /* we are going to access  34 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(17179869183);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 28)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 26)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 30));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 30));
}

/* we packed 256 35-bit values, touching 35 256-bit words, using 1120 bytes */
static void avxunpackblock35(const __m256i *compressed, u64 *pout) {
  /* we are going to access  35 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(34359738367);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 7)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 25)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 27)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 57),
                                             _mm256_slli_epi64(w0, 7))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 28)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 23)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 29));
}

/* we packed 256 36-bit values, touching 36 256-bit words, using 1152 bytes */
static void avxunpackblock36(const __m256i *compressed, u64 *pout) {
  /* we are going to access  36 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(68719476735);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 28));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 28));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 28));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 28));
}

/* we packed 256 37-bit values, touching 37 256-bit words, using 1184 bytes */
static void avxunpackblock37(const __m256i *compressed, u64 *pout) {
  /* we are going to access  37 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(137438953471);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 26)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 25)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 27));
}

/* we packed 256 38-bit values, touching 38 256-bit words, using 1216 bytes */
static void avxunpackblock38(const __m256i *compressed, u64 *pout) {
  /* we are going to access  38 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(274877906943);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 26));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 24)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 26));
}

/* we packed 256 39-bit values, touching 39 256-bit words, using 1248 bytes */
static void avxunpackblock39(const __m256i *compressed, u64 *pout) {
  /* we are going to access  39 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(549755813887);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 23)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 37),
                                             _mm256_slli_epi64(w0, 27))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 15)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 21)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 49),
                                             _mm256_slli_epi64(w0, 15))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 24)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 27),
                                             _mm256_slli_epi64(w0, 37))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 22)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 25));
}

/* we packed 256 40-bit values, touching 40 256-bit words, using 1280 bytes */
static void avxunpackblock40(const __m256i *compressed, u64 *pout) {
  /* we are going to access  40 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1099511627775);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w0, 24));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 24));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w0, 24));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 24));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w0, 24));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 24));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w0, 24));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 24));
}

/* we packed 256 41-bit values, touching 41 256-bit words, using 1312 bytes */
static void avxunpackblock41(const __m256i *compressed, u64 *pout) {
  /* we are going to access  41 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(2199023255551);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 31),
                                             _mm256_slli_epi64(w1, 33))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 49),
                                             _mm256_slli_epi64(w0, 15))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 21)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 19)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 22)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 25),
                                             _mm256_slli_epi64(w0, 39))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 15)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 23));
}

/* we packed 256 42-bit values, touching 42 256-bit words, using 1344 bytes */
static void avxunpackblock42(const __m256i *compressed, u64 *pout) {
  /* we are going to access  42 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(4398046511103);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  _mm256_storeu_si256(out + 2,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 20)));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 18)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 22));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 61,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 22));
}

/* we packed 256 43-bit values, touching 43 256-bit words, using 1376 bytes */
static void avxunpackblock43(const __m256i *compressed, u64 *pout) {
  /* we are going to access  43 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(8796093022207);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 23),
                                             _mm256_slli_epi64(w0, 41))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 25),
                                             _mm256_slli_epi64(w0, 39))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 27),
                                             _mm256_slli_epi64(w0, 37))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 37),
                                             _mm256_slli_epi64(w0, 27))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 17)));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 19)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 20)));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 21));
}

/* we packed 256 44-bit values, touching 44 256-bit words, using 1408 bytes */
static void avxunpackblock44(const __m256i *compressed, u64 *pout) {
  /* we are going to access  44 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(17592186044415);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 20));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 20));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 20));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 20));
}

/* we packed 256 45-bit values, touching 45 256-bit words, using 1440 bytes */
static void avxunpackblock45(const __m256i *compressed, u64 *pout) {
  /* we are going to access  45 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(35184372088831);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  _mm256_storeu_si256(out + 16,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 23),
                                             _mm256_slli_epi64(w0, 41))));
  _mm256_storeu_si256(out + 20,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 11)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 37),
                                             _mm256_slli_epi64(w0, 27))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 18)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 13)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 27),
                                             _mm256_slli_epi64(w0, 37))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 43,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  _mm256_storeu_si256(out + 47,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 17)));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 19));
}

/* we packed 256 46-bit values, touching 46 256-bit words, using 1472 bytes */
static void avxunpackblock46(const __m256i *compressed, u64 *pout) {
  /* we are going to access  46 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(70368744177663);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 14)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 18));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 16)));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 18));
}

/* we packed 256 47-bit values, touching 47 256-bit words, using 1504 bytes */
static void avxunpackblock47(const __m256i *compressed, u64 *pout) {
  /* we are going to access  47 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(140737488355327);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 3,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  _mm256_storeu_si256(out + 15,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 31),
                                             _mm256_slli_epi64(w1, 33))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 27),
                                             _mm256_slli_epi64(w0, 37))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 23),
                                             _mm256_slli_epi64(w1, 41))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 19),
                                             _mm256_slli_epi64(w0, 45))));
  _mm256_storeu_si256(out + 30,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 33,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 15)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 45),
                                             _mm256_slli_epi64(w0, 19))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 37),
                                             _mm256_slli_epi64(w0, 27))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  _mm256_storeu_si256(out + 48,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 16)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 21),
                                             _mm256_slli_epi64(w0, 43))));
  _mm256_storeu_si256(out + 60,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 17));
}

/* we packed 256 48-bit values, touching 48 256-bit words, using 1536 bytes */
static void avxunpackblock48(const __m256i *compressed, u64 *pout) {
  /* we are going to access  48 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(281474976710655);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 3, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 4, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 11, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 12, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 19, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 20, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 27, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 28, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 35, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(out + 36, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 43, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(out + 44, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 51, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(out + 52, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w1, 16));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  _mm256_storeu_si256(out + 59, _mm256_srli_epi64(w0, 16));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(out + 60, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 16));
}

/* we packed 256 49-bit values, touching 49 256-bit words, using 1568 bytes */
static void avxunpackblock49(const __m256i *compressed, u64 *pout) {
  /* we are going to access  49 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(562949953421311);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 23),
                                             _mm256_slli_epi64(w0, 41))));
  _mm256_storeu_si256(out + 8,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 13)));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 17),
                                             _mm256_slli_epi64(w0, 47))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 25),
                                             _mm256_slli_epi64(w0, 39))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 14)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  _mm256_storeu_si256(out + 55,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 15));
}

/* we packed 256 50-bit values, touching 50 256-bit words, using 1600 bytes */
static void avxunpackblock50(const __m256i *compressed, u64 *pout) {
  /* we are going to access  50 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1125899906842623);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 13,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  _mm256_storeu_si256(out + 22,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 14));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 41,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  _mm256_storeu_si256(out + 50,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 12)));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 14));
}

/* we packed 256 51-bit values, touching 51 256-bit words, using 1632 bytes */
static void avxunpackblock51(const __m256i *compressed, u64 *pout) {
  /* we are going to access  51 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(2251799813685247);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  _mm256_storeu_si256(out + 4,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 12)));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 37),
                                             _mm256_slli_epi64(w0, 27))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 11)));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 23),
                                             _mm256_slli_epi64(w1, 41))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 10)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 9)));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  _mm256_storeu_si256(out + 24,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 7)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 57),
                                             _mm256_slli_epi64(w0, 7))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  _mm256_storeu_si256(out + 39,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 5)));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 17),
                                             _mm256_slli_epi64(w1, 47))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 15),
                                             _mm256_slli_epi64(w1, 49))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 27),
                                             _mm256_slli_epi64(w0, 37))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 14),
                                             _mm256_slli_epi64(w1, 50))));
  _mm256_storeu_si256(out + 59,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 13));
}

/* we packed 256 52-bit values, touching 52 256-bit words, using 1664 bytes */
static void avxunpackblock52(const __m256i *compressed, u64 *pout) {
  /* we are going to access  52 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(4503599627370495);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 12));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 26,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 12));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 37,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 12));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 12));
}

/* we packed 256 53-bit values, touching 53 256-bit words, using 1696 bytes */
static void avxunpackblock53(const __m256i *compressed, u64 *pout) {
  /* we are going to access  53 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(9007199254740991);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 31),
                                             _mm256_slli_epi64(w1, 33))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 5,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 9)));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  _mm256_storeu_si256(out + 11,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 7)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 17,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 25),
                                             _mm256_slli_epi64(w0, 39))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 14),
                                             _mm256_slli_epi64(w1, 50))));
  _mm256_storeu_si256(out + 23,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 23),
                                             _mm256_slli_epi64(w1, 41))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  _mm256_storeu_si256(out + 29,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 21),
                                             _mm256_slli_epi64(w0, 43))));
  _mm256_storeu_si256(out + 34,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 10)));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  _mm256_storeu_si256(out + 40,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 17),
                                             _mm256_slli_epi64(w0, 47))));
  _mm256_storeu_si256(out + 46,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 15),
                                             _mm256_slli_epi64(w1, 49))));
  _mm256_storeu_si256(out + 52,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 57),
                                             _mm256_slli_epi64(w0, 7))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 13),
                                             _mm256_slli_epi64(w0, 51))));
  _mm256_storeu_si256(out + 58,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 11));
}

/* we packed 256 54-bit values, touching 54 256-bit words, using 1728 bytes */
static void avxunpackblock54(const __m256i *compressed, u64 *pout) {
  /* we are going to access  54 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(18014398509481983);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 14),
                                             _mm256_slli_epi64(w1, 50))));
  _mm256_storeu_si256(out + 6,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  _mm256_storeu_si256(out + 19,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 6)));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 10));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  _mm256_storeu_si256(out + 44,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 8)));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 12),
                                             _mm256_slli_epi64(w1, 52))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 57,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 10));
}

/* we packed 256 55-bit values, touching 55 256-bit words, using 1760 bytes */
static void avxunpackblock55(const __m256i *compressed, u64 *pout) {
  /* we are going to access  55 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(36028797018963967);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  _mm256_storeu_si256(out + 7,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 11),
                                             _mm256_slli_epi64(w0, 53))));
  _mm256_storeu_si256(out + 14,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 49),
                                             _mm256_slli_epi64(w0, 15))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 13),
                                             _mm256_slli_epi64(w0, 51))));
  _mm256_storeu_si256(out + 28,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 23),
                                             _mm256_slli_epi64(w1, 41))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  _mm256_storeu_si256(out + 35,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 15),
                                             _mm256_slli_epi64(w0, 49))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 49,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 7)));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 17),
                                             _mm256_slli_epi64(w0, 47))));
  _mm256_storeu_si256(out + 56,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 8)));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 9));
}

/* we packed 256 56-bit values, touching 56 256-bit words, using 1792 bytes */
static void avxunpackblock56(const __m256i *compressed, u64 *pout) {
  /* we are going to access  56 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(72057594037927935);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 7, _mm256_srli_epi64(w0, 8));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 8, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w1, 8));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 23, _mm256_srli_epi64(w0, 8));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 24, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 8));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 39, _mm256_srli_epi64(w0, 8));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(out + 40, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w1, 8));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  _mm256_storeu_si256(out + 55, _mm256_srli_epi64(w0, 8));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(out + 56, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 8));
}

/* we packed 256 57-bit values, touching 57 256-bit words, using 1824 bytes */
static void avxunpackblock57(const __m256i *compressed, u64 *pout) {
  /* we are going to access  57 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(144115188075855871);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 15),
                                             _mm256_slli_epi64(w1, 49))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 8),
                                             _mm256_slli_epi64(w0, 56))));
  _mm256_storeu_si256(out + 9,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 37),
                                             _mm256_slli_epi64(w0, 27))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 23),
                                             _mm256_slli_epi64(w0, 41))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 9),
                                             _mm256_slli_epi64(w0, 55))));
  _mm256_storeu_si256(out + 18,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 31),
                                             _mm256_slli_epi64(w1, 33))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 17),
                                             _mm256_slli_epi64(w1, 47))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  _mm256_storeu_si256(out + 27,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 3)));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 39),
                                             _mm256_slli_epi64(w0, 25))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 25),
                                             _mm256_slli_epi64(w0, 39))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 11),
                                             _mm256_slli_epi64(w0, 53))));
  _mm256_storeu_si256(out + 36,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  _mm256_storeu_si256(out + 45,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 5)));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 55),
                                             _mm256_slli_epi64(w0, 9))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 27),
                                             _mm256_slli_epi64(w0, 37))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 13),
                                             _mm256_slli_epi64(w0, 51))));
  _mm256_storeu_si256(out + 54,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 6)));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 7));
}

/* we packed 256 58-bit values, touching 58 256-bit words, using 1856 bytes */
static void avxunpackblock58(const __m256i *compressed, u64 *pout) {
  /* we are going to access  58 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(288230376151711743);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 10),
                                             _mm256_slli_epi64(w1, 54))));
  _mm256_storeu_si256(out + 10,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 8),
                                             _mm256_slli_epi64(w1, 56))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 6));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 4)));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 14),
                                             _mm256_slli_epi64(w1, 50))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 8),
                                             _mm256_slli_epi64(w0, 56))));
  _mm256_storeu_si256(out + 53,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 12),
                                             _mm256_slli_epi64(w1, 52))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 6));
}

/* we packed 256 59-bit values, touching 59 256-bit words, using 1888 bytes */
static void avxunpackblock59(const __m256i *compressed, u64 *pout) {
  /* we are going to access  59 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(576460752303423487);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 9),
                                             _mm256_slli_epi64(w1, 55))));
  _mm256_storeu_si256(out + 12,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 4)));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 63),
                                             _mm256_slli_epi64(w0, 1))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 43),
                                             _mm256_slli_epi64(w0, 21))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 33),
                                             _mm256_slli_epi64(w0, 31))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 23),
                                             _mm256_slli_epi64(w0, 41))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 13),
                                             _mm256_slli_epi64(w0, 51))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 8),
                                             _mm256_slli_epi64(w1, 56))));
  _mm256_storeu_si256(out + 25,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 3)));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 17),
                                             _mm256_slli_epi64(w1, 47))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 7),
                                             _mm256_slli_epi64(w1, 57))));
  _mm256_storeu_si256(out + 38,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 2)));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 61),
                                             _mm256_slli_epi64(w0, 3))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 51),
                                             _mm256_slli_epi64(w0, 13))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 31),
                                             _mm256_slli_epi64(w0, 33))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 21),
                                             _mm256_slli_epi64(w0, 43))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 11),
                                             _mm256_slli_epi64(w0, 53))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 6),
                                             _mm256_slli_epi64(w1, 58))));
  _mm256_storeu_si256(out + 51,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w1, 1)));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 15),
                                             _mm256_slli_epi64(w1, 49))));
  w0 = _mm256_lddqu_si256(compressed + 58);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 5));
}

/* we packed 256 60-bit values, touching 60 256-bit words, using 1920 bytes */
static void avxunpackblock60(const __m256i *compressed, u64 *pout) {
  /* we are going to access  60 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(1152921504606846975);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 12),
                                             _mm256_slli_epi64(w1, 52))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 8),
                                             _mm256_slli_epi64(w0, 56))));
  _mm256_storeu_si256(out + 15, _mm256_srli_epi64(w0, 4));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 16, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 8),
                                             _mm256_slli_epi64(w1, 56))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w1, 4));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 12),
                                             _mm256_slli_epi64(w1, 52))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 8),
                                             _mm256_slli_epi64(w0, 56))));
  _mm256_storeu_si256(out + 47, _mm256_srli_epi64(w0, 4));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(out + 48, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  w0 = _mm256_lddqu_si256(compressed + 58);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  w1 = _mm256_lddqu_si256(compressed + 59);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 8),
                                             _mm256_slli_epi64(w1, 56))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 4));
}

/* we packed 256 61-bit values, touching 61 256-bit words, using 1952 bytes */
static void avxunpackblock61(const __m256i *compressed, u64 *pout) {
  /* we are going to access  61 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(2305843009213693951);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 31),
                                             _mm256_slli_epi64(w1, 33))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 13),
                                             _mm256_slli_epi64(w1, 51))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 7),
                                             _mm256_slli_epi64(w1, 57))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 4),
                                             _mm256_slli_epi64(w0, 60))));
  _mm256_storeu_si256(out + 21,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 1)));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 59),
                                             _mm256_slli_epi64(w0, 5))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 53),
                                             _mm256_slli_epi64(w0, 11))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 47),
                                             _mm256_slli_epi64(w0, 17))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 41),
                                             _mm256_slli_epi64(w0, 23))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 35),
                                             _mm256_slli_epi64(w0, 29))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 29),
                                             _mm256_slli_epi64(w0, 35))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 23),
                                             _mm256_slli_epi64(w0, 41))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 17),
                                             _mm256_slli_epi64(w0, 47))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 14),
                                             _mm256_slli_epi64(w1, 50))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 11),
                                             _mm256_slli_epi64(w0, 53))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 8),
                                             _mm256_slli_epi64(w1, 56))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 5),
                                             _mm256_slli_epi64(w0, 59))));
  _mm256_storeu_si256(out + 42,
                      _mm256_and_si256(mask, _mm256_srli_epi64(w0, 2)));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 15),
                                             _mm256_slli_epi64(w1, 49))));
  w0 = _mm256_lddqu_si256(compressed + 58);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  w1 = _mm256_lddqu_si256(compressed + 59);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 9),
                                             _mm256_slli_epi64(w1, 55))));
  w0 = _mm256_lddqu_si256(compressed + 60);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 6),
                                             _mm256_slli_epi64(w0, 58))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 3));
}

/* we packed 256 62-bit values, touching 62 256-bit words, using 1984 bytes */
static void avxunpackblock62(const __m256i *compressed, u64 *pout) {
  /* we are going to access  62 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(4611686018427387903);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 62),
                                             _mm256_slli_epi64(w1, 2))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 58),
                                             _mm256_slli_epi64(w1, 6))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 54),
                                             _mm256_slli_epi64(w1, 10))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 50),
                                             _mm256_slli_epi64(w1, 14))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 46),
                                             _mm256_slli_epi64(w1, 18))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 42),
                                             _mm256_slli_epi64(w1, 22))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 38),
                                             _mm256_slli_epi64(w1, 26))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 34),
                                             _mm256_slli_epi64(w1, 30))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 30),
                                             _mm256_slli_epi64(w1, 34))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 26),
                                             _mm256_slli_epi64(w1, 38))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 22),
                                             _mm256_slli_epi64(w1, 42))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 18),
                                             _mm256_slli_epi64(w1, 46))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 14),
                                             _mm256_slli_epi64(w1, 50))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 10),
                                             _mm256_slli_epi64(w1, 54))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 8),
                                             _mm256_slli_epi64(w0, 56))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 6),
                                             _mm256_slli_epi64(w1, 58))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 4),
                                             _mm256_slli_epi64(w0, 60))));
  _mm256_storeu_si256(out + 31, _mm256_srli_epi64(w0, 2));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(out + 32, _mm256_and_si256(mask, w1));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 60),
                                             _mm256_slli_epi64(w1, 4))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 56),
                                             _mm256_slli_epi64(w1, 8))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 52),
                                             _mm256_slli_epi64(w1, 12))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 48),
                                             _mm256_slli_epi64(w1, 16))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 44),
                                             _mm256_slli_epi64(w1, 20))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 40),
                                             _mm256_slli_epi64(w1, 24))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 36),
                                             _mm256_slli_epi64(w1, 28))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 32),
                                             _mm256_slli_epi64(w1, 32))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 28),
                                             _mm256_slli_epi64(w1, 36))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 24),
                                             _mm256_slli_epi64(w1, 40))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 20),
                                             _mm256_slli_epi64(w1, 44))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 16),
                                             _mm256_slli_epi64(w1, 48))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 12),
                                             _mm256_slli_epi64(w1, 52))));
  w0 = _mm256_lddqu_si256(compressed + 58);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  w1 = _mm256_lddqu_si256(compressed + 59);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 8),
                                             _mm256_slli_epi64(w1, 56))));
  w0 = _mm256_lddqu_si256(compressed + 60);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 6),
                                             _mm256_slli_epi64(w0, 58))));
  w1 = _mm256_lddqu_si256(compressed + 61);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 4),
                                             _mm256_slli_epi64(w1, 60))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w1, 2));
}

/* we packed 256 63-bit values, touching 63 256-bit words, using 2016 bytes */
static void avxunpackblock63(const __m256i *compressed, u64 *pout) {
  /* we are going to access  63 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  const __m256i mask = _mm256_set1_epi64x(9223372036854775807);
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, _mm256_and_si256(mask, w0));
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(
      out + 1,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 63),
                                             _mm256_slli_epi64(w1, 1))));
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(
      out + 2,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 62),
                                             _mm256_slli_epi64(w0, 2))));
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(
      out + 3,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 61),
                                             _mm256_slli_epi64(w1, 3))));
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(
      out + 4,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 60),
                                             _mm256_slli_epi64(w0, 4))));
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(
      out + 5,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 59),
                                             _mm256_slli_epi64(w1, 5))));
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(
      out + 6,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 58),
                                             _mm256_slli_epi64(w0, 6))));
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(
      out + 7,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 57),
                                             _mm256_slli_epi64(w1, 7))));
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(
      out + 8,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 56),
                                             _mm256_slli_epi64(w0, 8))));
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(
      out + 9,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 55),
                                             _mm256_slli_epi64(w1, 9))));
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(
      out + 10,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 54),
                                             _mm256_slli_epi64(w0, 10))));
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(
      out + 11,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 53),
                                             _mm256_slli_epi64(w1, 11))));
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(
      out + 12,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 52),
                                             _mm256_slli_epi64(w0, 12))));
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(
      out + 13,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 51),
                                             _mm256_slli_epi64(w1, 13))));
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(
      out + 14,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 50),
                                             _mm256_slli_epi64(w0, 14))));
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(
      out + 15,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 49),
                                             _mm256_slli_epi64(w1, 15))));
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(
      out + 16,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 48),
                                             _mm256_slli_epi64(w0, 16))));
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(
      out + 17,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 47),
                                             _mm256_slli_epi64(w1, 17))));
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(
      out + 18,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 46),
                                             _mm256_slli_epi64(w0, 18))));
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(
      out + 19,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 45),
                                             _mm256_slli_epi64(w1, 19))));
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(
      out + 20,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 44),
                                             _mm256_slli_epi64(w0, 20))));
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(
      out + 21,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 43),
                                             _mm256_slli_epi64(w1, 21))));
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(
      out + 22,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 42),
                                             _mm256_slli_epi64(w0, 22))));
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(
      out + 23,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 41),
                                             _mm256_slli_epi64(w1, 23))));
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(
      out + 24,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 40),
                                             _mm256_slli_epi64(w0, 24))));
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(
      out + 25,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 39),
                                             _mm256_slli_epi64(w1, 25))));
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(
      out + 26,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 38),
                                             _mm256_slli_epi64(w0, 26))));
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(
      out + 27,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 37),
                                             _mm256_slli_epi64(w1, 27))));
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(
      out + 28,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 36),
                                             _mm256_slli_epi64(w0, 28))));
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(
      out + 29,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 35),
                                             _mm256_slli_epi64(w1, 29))));
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(
      out + 30,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 34),
                                             _mm256_slli_epi64(w0, 30))));
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(
      out + 31,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 33),
                                             _mm256_slli_epi64(w1, 31))));
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(
      out + 32,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 32),
                                             _mm256_slli_epi64(w0, 32))));
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(
      out + 33,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 31),
                                             _mm256_slli_epi64(w1, 33))));
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(
      out + 34,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 30),
                                             _mm256_slli_epi64(w0, 34))));
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(
      out + 35,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 29),
                                             _mm256_slli_epi64(w1, 35))));
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(
      out + 36,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 28),
                                             _mm256_slli_epi64(w0, 36))));
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(
      out + 37,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 27),
                                             _mm256_slli_epi64(w1, 37))));
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(
      out + 38,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 26),
                                             _mm256_slli_epi64(w0, 38))));
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(
      out + 39,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 25),
                                             _mm256_slli_epi64(w1, 39))));
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(
      out + 40,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 24),
                                             _mm256_slli_epi64(w0, 40))));
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(
      out + 41,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 23),
                                             _mm256_slli_epi64(w1, 41))));
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(
      out + 42,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 22),
                                             _mm256_slli_epi64(w0, 42))));
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(
      out + 43,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 21),
                                             _mm256_slli_epi64(w1, 43))));
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(
      out + 44,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 20),
                                             _mm256_slli_epi64(w0, 44))));
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(
      out + 45,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 19),
                                             _mm256_slli_epi64(w1, 45))));
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(
      out + 46,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 18),
                                             _mm256_slli_epi64(w0, 46))));
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(
      out + 47,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 17),
                                             _mm256_slli_epi64(w1, 47))));
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(
      out + 48,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 16),
                                             _mm256_slli_epi64(w0, 48))));
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(
      out + 49,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 15),
                                             _mm256_slli_epi64(w1, 49))));
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(
      out + 50,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 14),
                                             _mm256_slli_epi64(w0, 50))));
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(
      out + 51,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 13),
                                             _mm256_slli_epi64(w1, 51))));
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(
      out + 52,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 12),
                                             _mm256_slli_epi64(w0, 52))));
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(
      out + 53,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 11),
                                             _mm256_slli_epi64(w1, 53))));
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(
      out + 54,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 10),
                                             _mm256_slli_epi64(w0, 54))));
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(
      out + 55,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 9),
                                             _mm256_slli_epi64(w1, 55))));
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(
      out + 56,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 8),
                                             _mm256_slli_epi64(w0, 56))));
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(
      out + 57,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 7),
                                             _mm256_slli_epi64(w1, 57))));
  w0 = _mm256_lddqu_si256(compressed + 58);
  _mm256_storeu_si256(
      out + 58,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 6),
                                             _mm256_slli_epi64(w0, 58))));
  w1 = _mm256_lddqu_si256(compressed + 59);
  _mm256_storeu_si256(
      out + 59,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 5),
                                             _mm256_slli_epi64(w1, 59))));
  w0 = _mm256_lddqu_si256(compressed + 60);
  _mm256_storeu_si256(
      out + 60,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 4),
                                             _mm256_slli_epi64(w0, 60))));
  w1 = _mm256_lddqu_si256(compressed + 61);
  _mm256_storeu_si256(
      out + 61,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w0, 3),
                                             _mm256_slli_epi64(w1, 61))));
  w0 = _mm256_lddqu_si256(compressed + 62);
  _mm256_storeu_si256(
      out + 62,
      _mm256_and_si256(mask, _mm256_or_si256(_mm256_srli_epi64(w1, 2),
                                             _mm256_slli_epi64(w0, 62))));
  _mm256_storeu_si256(out + 63, _mm256_srli_epi64(w0, 1));
}

/* we packed 256 64-bit values, touching 64 256-bit words, using 2048 bytes */
static void avxunpackblock64(const __m256i *compressed, u64 *pout) {
  /* we are going to access  64 256-bit words */
  __m256i w0, w1;
  __m256i *out = (__m256i *)pout;
  w0 = _mm256_lddqu_si256(compressed);
  _mm256_storeu_si256(out + 0, w0);
  w1 = _mm256_lddqu_si256(compressed + 1);
  _mm256_storeu_si256(out + 1, w1);
  w0 = _mm256_lddqu_si256(compressed + 2);
  _mm256_storeu_si256(out + 2, w0);
  w1 = _mm256_lddqu_si256(compressed + 3);
  _mm256_storeu_si256(out + 3, w1);
  w0 = _mm256_lddqu_si256(compressed + 4);
  _mm256_storeu_si256(out + 4, w0);
  w1 = _mm256_lddqu_si256(compressed + 5);
  _mm256_storeu_si256(out + 5, w1);
  w0 = _mm256_lddqu_si256(compressed + 6);
  _mm256_storeu_si256(out + 6, w0);
  w1 = _mm256_lddqu_si256(compressed + 7);
  _mm256_storeu_si256(out + 7, w1);
  w0 = _mm256_lddqu_si256(compressed + 8);
  _mm256_storeu_si256(out + 8, w0);
  w1 = _mm256_lddqu_si256(compressed + 9);
  _mm256_storeu_si256(out + 9, w1);
  w0 = _mm256_lddqu_si256(compressed + 10);
  _mm256_storeu_si256(out + 10, w0);
  w1 = _mm256_lddqu_si256(compressed + 11);
  _mm256_storeu_si256(out + 11, w1);
  w0 = _mm256_lddqu_si256(compressed + 12);
  _mm256_storeu_si256(out + 12, w0);
  w1 = _mm256_lddqu_si256(compressed + 13);
  _mm256_storeu_si256(out + 13, w1);
  w0 = _mm256_lddqu_si256(compressed + 14);
  _mm256_storeu_si256(out + 14, w0);
  w1 = _mm256_lddqu_si256(compressed + 15);
  _mm256_storeu_si256(out + 15, w1);
  w0 = _mm256_lddqu_si256(compressed + 16);
  _mm256_storeu_si256(out + 16, w0);
  w1 = _mm256_lddqu_si256(compressed + 17);
  _mm256_storeu_si256(out + 17, w1);
  w0 = _mm256_lddqu_si256(compressed + 18);
  _mm256_storeu_si256(out + 18, w0);
  w1 = _mm256_lddqu_si256(compressed + 19);
  _mm256_storeu_si256(out + 19, w1);
  w0 = _mm256_lddqu_si256(compressed + 20);
  _mm256_storeu_si256(out + 20, w0);
  w1 = _mm256_lddqu_si256(compressed + 21);
  _mm256_storeu_si256(out + 21, w1);
  w0 = _mm256_lddqu_si256(compressed + 22);
  _mm256_storeu_si256(out + 22, w0);
  w1 = _mm256_lddqu_si256(compressed + 23);
  _mm256_storeu_si256(out + 23, w1);
  w0 = _mm256_lddqu_si256(compressed + 24);
  _mm256_storeu_si256(out + 24, w0);
  w1 = _mm256_lddqu_si256(compressed + 25);
  _mm256_storeu_si256(out + 25, w1);
  w0 = _mm256_lddqu_si256(compressed + 26);
  _mm256_storeu_si256(out + 26, w0);
  w1 = _mm256_lddqu_si256(compressed + 27);
  _mm256_storeu_si256(out + 27, w1);
  w0 = _mm256_lddqu_si256(compressed + 28);
  _mm256_storeu_si256(out + 28, w0);
  w1 = _mm256_lddqu_si256(compressed + 29);
  _mm256_storeu_si256(out + 29, w1);
  w0 = _mm256_lddqu_si256(compressed + 30);
  _mm256_storeu_si256(out + 30, w0);
  w1 = _mm256_lddqu_si256(compressed + 31);
  _mm256_storeu_si256(out + 31, w1);
  w0 = _mm256_lddqu_si256(compressed + 32);
  _mm256_storeu_si256(out + 32, w0);
  w1 = _mm256_lddqu_si256(compressed + 33);
  _mm256_storeu_si256(out + 33, w1);
  w0 = _mm256_lddqu_si256(compressed + 34);
  _mm256_storeu_si256(out + 34, w0);
  w1 = _mm256_lddqu_si256(compressed + 35);
  _mm256_storeu_si256(out + 35, w1);
  w0 = _mm256_lddqu_si256(compressed + 36);
  _mm256_storeu_si256(out + 36, w0);
  w1 = _mm256_lddqu_si256(compressed + 37);
  _mm256_storeu_si256(out + 37, w1);
  w0 = _mm256_lddqu_si256(compressed + 38);
  _mm256_storeu_si256(out + 38, w0);
  w1 = _mm256_lddqu_si256(compressed + 39);
  _mm256_storeu_si256(out + 39, w1);
  w0 = _mm256_lddqu_si256(compressed + 40);
  _mm256_storeu_si256(out + 40, w0);
  w1 = _mm256_lddqu_si256(compressed + 41);
  _mm256_storeu_si256(out + 41, w1);
  w0 = _mm256_lddqu_si256(compressed + 42);
  _mm256_storeu_si256(out + 42, w0);
  w1 = _mm256_lddqu_si256(compressed + 43);
  _mm256_storeu_si256(out + 43, w1);
  w0 = _mm256_lddqu_si256(compressed + 44);
  _mm256_storeu_si256(out + 44, w0);
  w1 = _mm256_lddqu_si256(compressed + 45);
  _mm256_storeu_si256(out + 45, w1);
  w0 = _mm256_lddqu_si256(compressed + 46);
  _mm256_storeu_si256(out + 46, w0);
  w1 = _mm256_lddqu_si256(compressed + 47);
  _mm256_storeu_si256(out + 47, w1);
  w0 = _mm256_lddqu_si256(compressed + 48);
  _mm256_storeu_si256(out + 48, w0);
  w1 = _mm256_lddqu_si256(compressed + 49);
  _mm256_storeu_si256(out + 49, w1);
  w0 = _mm256_lddqu_si256(compressed + 50);
  _mm256_storeu_si256(out + 50, w0);
  w1 = _mm256_lddqu_si256(compressed + 51);
  _mm256_storeu_si256(out + 51, w1);
  w0 = _mm256_lddqu_si256(compressed + 52);
  _mm256_storeu_si256(out + 52, w0);
  w1 = _mm256_lddqu_si256(compressed + 53);
  _mm256_storeu_si256(out + 53, w1);
  w0 = _mm256_lddqu_si256(compressed + 54);
  _mm256_storeu_si256(out + 54, w0);
  w1 = _mm256_lddqu_si256(compressed + 55);
  _mm256_storeu_si256(out + 55, w1);
  w0 = _mm256_lddqu_si256(compressed + 56);
  _mm256_storeu_si256(out + 56, w0);
  w1 = _mm256_lddqu_si256(compressed + 57);
  _mm256_storeu_si256(out + 57, w1);
  w0 = _mm256_lddqu_si256(compressed + 58);
  _mm256_storeu_si256(out + 58, w0);
  w1 = _mm256_lddqu_si256(compressed + 59);
  _mm256_storeu_si256(out + 59, w1);
  w0 = _mm256_lddqu_si256(compressed + 60);
  _mm256_storeu_si256(out + 60, w0);
  w1 = _mm256_lddqu_si256(compressed + 61);
  _mm256_storeu_si256(out + 61, w1);
  w0 = _mm256_lddqu_si256(compressed + 62);
  _mm256_storeu_si256(out + 62, w0);
  w1 = _mm256_lddqu_si256(compressed + 63);
  _mm256_storeu_si256(out + 63, w1);
}

static avxpackblockfnc avxfuncPackArr[] = {
    &avxpackblock0,  &avxpackblock1,  &avxpackblock2,  &avxpackblock3,
    &avxpackblock4,  &avxpackblock5,  &avxpackblock6,  &avxpackblock7,
    &avxpackblock8,  &avxpackblock9,  &avxpackblock10, &avxpackblock11,
    &avxpackblock12, &avxpackblock13, &avxpackblock14, &avxpackblock15,
    &avxpackblock16, &avxpackblock17, &avxpackblock18, &avxpackblock19,
    &avxpackblock20, &avxpackblock21, &avxpackblock22, &avxpackblock23,
    &avxpackblock24, &avxpackblock25, &avxpackblock26, &avxpackblock27,
    &avxpackblock28, &avxpackblock29, &avxpackblock30, &avxpackblock31,
    &avxpackblock32, &avxpackblock33, &avxpackblock34, &avxpackblock35,
    &avxpackblock36, &avxpackblock37, &avxpackblock38, &avxpackblock39,
    &avxpackblock40, &avxpackblock41, &avxpackblock42, &avxpackblock43,
    &avxpackblock44, &avxpackblock45, &avxpackblock46, &avxpackblock47,
    &avxpackblock48, &avxpackblock49, &avxpackblock50, &avxpackblock51,
    &avxpackblock52, &avxpackblock53, &avxpackblock54, &avxpackblock55,
    &avxpackblock56, &avxpackblock57, &avxpackblock58, &avxpackblock59,
    &avxpackblock60, &avxpackblock61, &avxpackblock62, &avxpackblock63,
    &avxpackblock64};
static avxpackblockfnc avxfuncPackMaskArr[] = {
    &avxpackblockmask0,  &avxpackblockmask1,  &avxpackblockmask2,
    &avxpackblockmask3,  &avxpackblockmask4,  &avxpackblockmask5,
    &avxpackblockmask6,  &avxpackblockmask7,  &avxpackblockmask8,
    &avxpackblockmask9,  &avxpackblockmask10, &avxpackblockmask11,
    &avxpackblockmask12, &avxpackblockmask13, &avxpackblockmask14,
    &avxpackblockmask15, &avxpackblockmask16, &avxpackblockmask17,
    &avxpackblockmask18, &avxpackblockmask19, &avxpackblockmask20,
    &avxpackblockmask21, &avxpackblockmask22, &avxpackblockmask23,
    &avxpackblockmask24, &avxpackblockmask25, &avxpackblockmask26,
    &avxpackblockmask27, &avxpackblockmask28, &avxpackblockmask29,
    &avxpackblockmask30, &avxpackblockmask31, &avxpackblockmask32,
    &avxpackblockmask33, &avxpackblockmask34, &avxpackblockmask35,
    &avxpackblockmask36, &avxpackblockmask37, &avxpackblockmask38,
    &avxpackblockmask39, &avxpackblockmask40, &avxpackblockmask41,
    &avxpackblockmask42, &avxpackblockmask43, &avxpackblockmask44,
    &avxpackblockmask45, &avxpackblockmask46, &avxpackblockmask47,
    &avxpackblockmask48, &avxpackblockmask49, &avxpackblockmask50,
    &avxpackblockmask51, &avxpackblockmask52, &avxpackblockmask53,
    &avxpackblockmask54, &avxpackblockmask55, &avxpackblockmask56,
    &avxpackblockmask57, &avxpackblockmask58, &avxpackblockmask59,
    &avxpackblockmask60, &avxpackblockmask61, &avxpackblockmask62,
    &avxpackblockmask63, &avxpackblockmask64};
static avxunpackblockfnc avxfuncUnpackArr[] = {
    &avxunpackblock0,  &avxunpackblock1,  &avxunpackblock2,  &avxunpackblock3,
    &avxunpackblock4,  &avxunpackblock5,  &avxunpackblock6,  &avxunpackblock7,
    &avxunpackblock8,  &avxunpackblock9,  &avxunpackblock10, &avxunpackblock11,
    &avxunpackblock12, &avxunpackblock13, &avxunpackblock14, &avxunpackblock15,
    &avxunpackblock16, &avxunpackblock17, &avxunpackblock18, &avxunpackblock19,
    &avxunpackblock20, &avxunpackblock21, &avxunpackblock22, &avxunpackblock23,
    &avxunpackblock24, &avxunpackblock25, &avxunpackblock26, &avxunpackblock27,
    &avxunpackblock28, &avxunpackblock29, &avxunpackblock30, &avxunpackblock31,
    &avxunpackblock32, &avxunpackblock33, &avxunpackblock34, &avxunpackblock35,
    &avxunpackblock36, &avxunpackblock37, &avxunpackblock38, &avxunpackblock39,
    &avxunpackblock40, &avxunpackblock41, &avxunpackblock42, &avxunpackblock43,
    &avxunpackblock44, &avxunpackblock45, &avxunpackblock46, &avxunpackblock47,
    &avxunpackblock48, &avxunpackblock49, &avxunpackblock50, &avxunpackblock51,
    &avxunpackblock52, &avxunpackblock53, &avxunpackblock54, &avxunpackblock55,
    &avxunpackblock56, &avxunpackblock57, &avxunpackblock58, &avxunpackblock59,
    &avxunpackblock60, &avxunpackblock61, &avxunpackblock62, &avxunpackblock63,
    &avxunpackblock64};
//---------------------------------------------------------------------------
void avxpack(const u64 *in, __m256i *out, const u8 bit) {
  avxfuncPackMaskArr[bit](in, out);
}
//---------------------------------------------------------------------------
void avxpackwithoutmask(const u64 *in, __m256i *out, const u8 bit) {
  avxfuncPackArr[bit](in, out);
}
//---------------------------------------------------------------------------
void avxunpack(const __m256i *in, u64 *out, const u8 bit) {
  avxfuncUnpackArr[bit](in, out);
}
//---------------------------------------------------------------------------
} // namespace simd64
//---------------------------------------------------------------------------
} // namespace bitpacking
//---------------------------------------------------------------------------
} // namespace compression